<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4 コックス回帰モデル | Event History and Survival Analysis Using R</title>
  <meta name="description" content="4 コックス回帰モデル | Event History and Survival Analysis Using R" />
  <meta name="generator" content="bookdown 0.35 and GitBook 2.6.7" />

  <meta property="og:title" content="4 コックス回帰モデル | Event History and Survival Analysis Using R" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 コックス回帰モデル | Event History and Survival Analysis Using R" />
  
  
  

<meta name="author" content="Tsubasa Yamaguchi" />


<meta name="date" content="2023-11-12" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="Chapter3.html"/>
<link rel="next" href="Chapter5.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="libs/pagedtable-1.1/js/pagedtable.js"></script>
<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.6.1/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.27/datatables.js"></script>
<link href="libs/dt-core-1.12.1/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.12.1/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.12.1/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<link href="libs/tabwid-1.1.3/tabwid.css" rel="stylesheet" />
<script src="libs/tabwid-1.1.3/tabwid.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="custom_style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>本稿の目的</a></li>
<li class="chapter" data-level="" data-path="Chapter0.html"><a href="Chapter0.html"><i class="fa fa-check"></i>0. パッケージの読み込み</a></li>
<li class="chapter" data-level="1" data-path="Chapter1.html"><a href="Chapter1.html"><i class="fa fa-check"></i><b>1</b> はじめに</a>
<ul>
<li class="chapter" data-level="1.1" data-path="Chapter1.html"><a href="Chapter1.html#s2-1"><i class="fa fa-check"></i><b>1.1</b> イベントヒストリー分析とは何か</a></li>
<li class="chapter" data-level="1.2" data-path="Chapter1.html"><a href="Chapter1.html#s2-2"><i class="fa fa-check"></i><b>1.2</b> イベント・ヒストリー分析の難しさ</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="Chapter1.html"><a href="Chapter1.html#打ち切り"><i class="fa fa-check"></i><b>1.2.1</b> 打ち切り</a></li>
<li class="chapter" data-level="1.2.2" data-path="Chapter1.html"><a href="Chapter1.html#時間依存共変量"><i class="fa fa-check"></i><b>1.2.2</b> 時間依存共変量</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="Chapter1.html"><a href="Chapter1.html#s2-3"><i class="fa fa-check"></i><b>1.3</b> イベント・ヒストリー分析の種類</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="Chapter1.html"><a href="Chapter1.html#繰り返しの有無"><i class="fa fa-check"></i><b>1.3.1</b> 繰り返しの有無</a></li>
<li class="chapter" data-level="1.3.2" data-path="Chapter1.html"><a href="Chapter1.html#単一の事象と複数の事象"><i class="fa fa-check"></i><b>1.3.2</b> 単一の事象と複数の事象</a></li>
<li class="chapter" data-level="1.3.3" data-path="Chapter1.html"><a href="Chapter1.html#パラメトリック法とノンパラメトリック法"><i class="fa fa-check"></i><b>1.3.3</b> パラメトリック法とノンパラメトリック法</a></li>
<li class="chapter" data-level="1.3.4" data-path="Chapter1.html"><a href="Chapter1.html#離散時間と連続時間"><i class="fa fa-check"></i><b>1.3.4</b> 離散時間と連続時間</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="Chapter2.html"><a href="Chapter2.html"><i class="fa fa-check"></i><b>2</b> パラメトリックな離散時間モデル</a>
<ul>
<li class="chapter" data-level="2.1" data-path="Chapter2.html"><a href="Chapter2.html#離散時間モデルの例"><i class="fa fa-check"></i><b>2.1</b> 離散時間モデルの例</a></li>
<li class="chapter" data-level="2.2" data-path="Chapter2.html"><a href="Chapter2.html#離散時間ハザード"><i class="fa fa-check"></i><b>2.2</b> 離散時間ハザード</a></li>
<li class="chapter" data-level="2.3" data-path="Chapter2.html"><a href="Chapter2.html#ロジスティック回帰モデル"><i class="fa fa-check"></i><b>2.3</b> ロジスティック回帰モデル</a></li>
<li class="chapter" data-level="2.4" data-path="Chapter2.html"><a href="Chapter2.html#モデルの推定"><i class="fa fa-check"></i><b>2.4</b> モデルの推定</a></li>
<li class="chapter" data-level="2.5" data-path="Chapter2.html"><a href="Chapter2.html#rでの実装"><i class="fa fa-check"></i><b>2.5</b> Rでの実装</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="Chapter2.html"><a href="Chapter2.html#データの加工"><i class="fa fa-check"></i><b>2.5.1</b> データの加工</a></li>
<li class="chapter" data-level="2.5.2" data-path="Chapter2.html"><a href="Chapter2.html#分析"><i class="fa fa-check"></i><b>2.5.2</b> 分析</a></li>
<li class="chapter" data-level="2.5.3" data-path="Chapter2.html"><a href="Chapter2.html#結果の解釈"><i class="fa fa-check"></i><b>2.5.3</b> 結果の解釈</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="Chapter2.html"><a href="Chapter2.html#尤度比検定"><i class="fa fa-check"></i><b>2.6</b> 尤度比検定</a></li>
<li class="chapter" data-level="2.7" data-path="Chapter2.html"><a href="Chapter2.html#離散時間ロジスティック回帰モデルの注意点"><i class="fa fa-check"></i><b>2.7</b> 離散時間ロジスティック回帰モデルの注意点</a></li>
<li class="chapter" data-level="2.8" data-path="Chapter2.html"><a href="Chapter2.html#s2-8"><i class="fa fa-check"></i><b>2.8</b> 打ち切りデータの扱い</a></li>
<li class="chapter" data-level="2.9" data-path="Chapter2.html"><a href="Chapter2.html#離散時間モデルと連続時間モデル"><i class="fa fa-check"></i><b>2.9</b> 離散時間モデルと連続時間モデル</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="Chapter3.html"><a href="Chapter3.html"><i class="fa fa-check"></i><b>3</b> 連続時間を用いたパラメトリックな手法</a>
<ul>
<li class="chapter" data-level="3.1" data-path="Chapter3.html"><a href="Chapter3.html#連続時間ハザード率"><i class="fa fa-check"></i><b>3.1</b> 連続時間ハザード率</a></li>
<li class="chapter" data-level="3.2" data-path="Chapter3.html"><a href="Chapter3.html#パラメトリックな比例ハザードモデル"><i class="fa fa-check"></i><b>3.2</b> パラメトリックな比例ハザードモデル</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="Chapter3.html"><a href="Chapter3.html#モデルの分類"><i class="fa fa-check"></i><b>3.2.1</b> モデルの分類</a>
<ul>
<li class="chapter" data-level="3.2.1.1" data-path="Chapter3.html"><a href="Chapter3.html#指数回帰モデル"><i class="fa fa-check"></i><b>3.2.1.1</b> 指数回帰モデル</a></li>
<li class="chapter" data-level="3.2.1.2" data-path="Chapter3.html"><a href="Chapter3.html#ゴンぺルツ回帰モデル"><i class="fa fa-check"></i><b>3.2.1.2</b> ゴンぺルツ回帰モデル</a></li>
<li class="chapter" data-level="3.2.1.3" data-path="Chapter3.html"><a href="Chapter3.html#ワイブル回帰モデル"><i class="fa fa-check"></i><b>3.2.1.3</b> ワイブル回帰モデル</a></li>
</ul></li>
<li class="chapter" data-level="3.2.2" data-path="Chapter3.html"><a href="Chapter3.html#注意点"><i class="fa fa-check"></i><b>3.2.2</b> 注意点</a></li>
<li class="chapter" data-level="3.2.3" data-path="Chapter3.html"><a href="Chapter3.html#rでの実装-1"><i class="fa fa-check"></i><b>3.2.3</b> Rでの実装</a>
<ul>
<li class="chapter" data-level="3.2.3.1" data-path="Chapter3.html"><a href="Chapter3.html#データの読み込み"><i class="fa fa-check"></i><b>3.2.3.1</b> データの読み込み</a></li>
<li class="chapter" data-level="3.2.3.2" data-path="Chapter3.html"><a href="Chapter3.html#分析の実行"><i class="fa fa-check"></i><b>3.2.3.2</b> 分析の実行</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="Chapter3.html"><a href="Chapter3.html#s3-3"><i class="fa fa-check"></i><b>3.3</b> 加速時間ハザードモデル</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="Chapter3.html"><a href="Chapter3.html#モデルの概要"><i class="fa fa-check"></i><b>3.3.1</b> モデルの概要</a></li>
<li class="chapter" data-level="3.3.2" data-path="Chapter3.html"><a href="Chapter3.html#rでの実装-2"><i class="fa fa-check"></i><b>3.3.2</b> Rでの実装</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="Chapter3.html"><a href="Chapter3.html#適合度の評価"><i class="fa fa-check"></i><b>3.4</b> 適合度の評価</a></li>
<li class="chapter" data-level="3.5" data-path="Chapter3.html"><a href="Chapter3.html#観察されない異質性の原因"><i class="fa fa-check"></i><b>3.5</b> 観察されない異質性の原因</a></li>
<li class="chapter" data-level="3.6" data-path="Chapter3.html"><a href="Chapter3.html#なぜパラメトリックモデルを用いるのか"><i class="fa fa-check"></i><b>3.6</b> なぜパラメトリックモデルを用いるのか</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="Chapter4.html"><a href="Chapter4.html"><i class="fa fa-check"></i><b>4</b> コックス回帰モデル</a>
<ul>
<li class="chapter" data-level="4.1" data-path="Chapter4.html"><a href="Chapter4.html#比例ハザードモデル"><i class="fa fa-check"></i><b>4.1</b> 比例ハザードモデル</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="Chapter4.html"><a href="Chapter4.html#モデルの概要-1"><i class="fa fa-check"></i><b>4.1.1</b> モデルの概要</a></li>
<li class="chapter" data-level="4.1.2" data-path="Chapter4.html"><a href="Chapter4.html#部分尤度法"><i class="fa fa-check"></i><b>4.1.2</b> 部分尤度法</a></li>
<li class="chapter" data-level="4.1.3" data-path="Chapter4.html"><a href="Chapter4.html#rによる実装"><i class="fa fa-check"></i><b>4.1.3</b> Rによる実装</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="Chapter4.html"><a href="Chapter4.html#時間に依存する独立変数を含むコックス回帰"><i class="fa fa-check"></i><b>4.2</b> 時間に依存する独立変数を含むコックス回帰</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="Chapter4.html"><a href="Chapter4.html#モデルの概要-2"><i class="fa fa-check"></i><b>4.2.1</b> モデルの概要</a></li>
<li class="chapter" data-level="4.2.2" data-path="Chapter4.html"><a href="Chapter4.html#rでの実装-3"><i class="fa fa-check"></i><b>4.2.2</b> Rでの実装</a></li>
<li class="chapter" data-level="4.2.3" data-path="Chapter4.html"><a href="Chapter4.html#モデルの比較"><i class="fa fa-check"></i><b>4.2.3</b> モデルの比較</a></li>
<li class="chapter" data-level="4.2.4" data-path="Chapter4.html"><a href="Chapter4.html#データに欠損がある場合の補完と加工"><i class="fa fa-check"></i><b>4.2.4</b> データに欠損がある場合の補完と加工</a>
<ul>
<li class="chapter" data-level="4.2.4.1" data-path="Chapter4.html"><a href="Chapter4.html#プログラミングステートメント法programming-statements-method"><i class="fa fa-check"></i><b>4.2.4.1</b> プログラミング・ステートメント法(programming statements method)</a></li>
<li class="chapter" data-level="4.2.4.2" data-path="Chapter4.html"><a href="Chapter4.html#エピソード分割法episode-splitting-method"><i class="fa fa-check"></i><b>4.2.4.2</b> エピソード分割法(episode splitting method)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="Chapter4.html"><a href="Chapter4.html#比例ハザード性の仮定の検討と修正"><i class="fa fa-check"></i><b>4.3</b> 比例ハザード性の仮定の検討と修正</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="Chapter4.html"><a href="Chapter4.html#シェーンフィールド残差を用いた検討"><i class="fa fa-check"></i><b>4.3.1</b> シェーンフィールド残差を用いた検討</a></li>
<li class="chapter" data-level="4.3.2" data-path="Chapter4.html"><a href="Chapter4.html#仮定が満たされないときの修正"><i class="fa fa-check"></i><b>4.3.2</b> 仮定が満たされないときの修正</a>
<ul>
<li class="chapter" data-level="4.3.2.1" data-path="Chapter4.html"><a href="Chapter4.html#時間との交互作用をモデルに加える"><i class="fa fa-check"></i><b>4.3.2.1</b> 時間との交互作用をモデルに加える</a></li>
<li class="chapter" data-level="4.3.2.2" data-path="Chapter4.html"><a href="Chapter4.html#層化stratification"><i class="fa fa-check"></i><b>4.3.2.2</b> 層化(stratification)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="Chapter4.html"><a href="Chapter4.html#観測期間の選択"><i class="fa fa-check"></i><b>4.4</b> 観測期間の選択</a></li>
<li class="chapter" data-level="4.5" data-path="Chapter4.html"><a href="Chapter4.html#コックスモデルによる予測"><i class="fa fa-check"></i><b>4.5</b> コックス・モデルによる予測</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="Chapter5.html"><a href="Chapter5.html"><i class="fa fa-check"></i><b>5</b> 複数事象のモデル</a>
<ul>
<li class="chapter" data-level="5.1" data-path="Chapter5.html"><a href="Chapter5.html#複数事象の分類"><i class="fa fa-check"></i><b>5.1</b> 複数事象の分類</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="Chapter5.html"><a href="Chapter5.html#条件付き過程"><i class="fa fa-check"></i><b>5.1.1</b> 条件付き過程</a></li>
<li class="chapter" data-level="5.1.2" data-path="Chapter5.html"><a href="Chapter5.html#並行的過程"><i class="fa fa-check"></i><b>5.1.2</b> 並行的過程</a>
<ul>
<li class="chapter" data-level="5.1.2.1" data-path="Chapter5.html"><a href="Chapter5.html#つのタイプ"><i class="fa fa-check"></i><b>5.1.2.1</b> 4つのタイプ</a></li>
<li class="chapter" data-level="5.1.2.2" data-path="Chapter5.html"><a href="Chapter5.html#並行的過程のタイプごとの分析"><i class="fa fa-check"></i><b>5.1.2.2</b> 並行的過程のタイプごとの分析</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="Chapter5.html"><a href="Chapter5.html#競合リスクモデル"><i class="fa fa-check"></i><b>5.2</b> 競合リスク・モデル</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="Chapter5.html"><a href="Chapter5.html#モデルの概要-3"><i class="fa fa-check"></i><b>5.2.1</b> モデルの概要</a></li>
<li class="chapter" data-level="5.2.2" data-path="Chapter5.html"><a href="Chapter5.html#rでの実装-4"><i class="fa fa-check"></i><b>5.2.2</b> Rでの実装</a>
<ul>
<li class="chapter" data-level="5.2.2.1" data-path="Chapter5.html"><a href="Chapter5.html#事象の種類を区別しないで分析"><i class="fa fa-check"></i><b>5.2.2.1</b> 事象の種類を区別しないで分析</a></li>
<li class="chapter" data-level="5.2.2.2" data-path="Chapter5.html"><a href="Chapter5.html#再犯の種類ごとに分析"><i class="fa fa-check"></i><b>5.2.2.2</b> 再犯の種類ごとに分析</a></li>
</ul></li>
<li class="chapter" data-level="5.2.3" data-path="Chapter5.html"><a href="Chapter5.html#注意点-1"><i class="fa fa-check"></i><b>5.2.3</b> 注意点</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="Chapter5.html"><a href="Chapter5.html#部分分布を用いた競合リスクの分析"><i class="fa fa-check"></i><b>5.3</b> 部分分布を用いた競合リスクの分析</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="Chapter5.html"><a href="Chapter5.html#モデルの概要-4"><i class="fa fa-check"></i><b>5.3.1</b> モデルの概要</a></li>
<li class="chapter" data-level="5.3.2" data-path="Chapter5.html"><a href="Chapter5.html#rでの実装-5"><i class="fa fa-check"></i><b>5.3.2</b> Rでの実装</a></li>
<li class="chapter" data-level="5.3.3" data-path="Chapter5.html"><a href="Chapter5.html#累積発生率関数の予測値"><i class="fa fa-check"></i><b>5.3.3</b> 累積発生率関数の予測値</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="Chapter6.html"><a href="Chapter6.html"><i class="fa fa-check"></i><b>6</b> 繰り返しのある事象モデル</a>
<ul>
<li class="chapter" data-level="6.1" data-path="Chapter6.html"><a href="Chapter6.html#繰り返しのある事象のカウントデータモデル"><i class="fa fa-check"></i><b>6.1</b> 繰り返しのある事象のカウントデータ・モデル</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="Chapter6.html"><a href="Chapter6.html#モデルの概要-5"><i class="fa fa-check"></i><b>6.1.1</b> モデルの概要</a></li>
<li class="chapter" data-level="6.1.2" data-path="Chapter6.html"><a href="Chapter6.html#rでの実装-6"><i class="fa fa-check"></i><b>6.1.2</b> Rでの実装</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="Chapter6.html"><a href="Chapter6.html#時間のギャップに基づく方法"><i class="fa fa-check"></i><b>6.2</b> 時間のギャップに基づく方法</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="Chapter6.html"><a href="Chapter6.html#モデルの概要-6"><i class="fa fa-check"></i><b>6.2.1</b> モデルの概要</a></li>
<li class="chapter" data-level="6.2.2" data-path="Chapter6.html"><a href="Chapter6.html#rでの実装-7"><i class="fa fa-check"></i><b>6.2.2</b> Rでの実装</a></li>
<li class="chapter" data-level="6.2.3" data-path="Chapter6.html"><a href="Chapter6.html#データの非独立性の問題"><i class="fa fa-check"></i><b>6.2.3</b> データの非独立性の問題</a>
<ul>
<li class="chapter" data-level="6.2.3.1" data-path="Chapter6.html"><a href="Chapter6.html#頑強推定"><i class="fa fa-check"></i><b>6.2.3.1</b> 頑強推定</a></li>
<li class="chapter" data-level="6.2.3.2" data-path="Chapter6.html"><a href="Chapter6.html#共用フレイルティモデル"><i class="fa fa-check"></i><b>6.2.3.2</b> 共用フレイルティ・モデル</a></li>
<li class="chapter" data-level="6.2.3.3" data-path="Chapter6.html"><a href="Chapter6.html#モデルの比較-1"><i class="fa fa-check"></i><b>6.2.3.3</b> モデルの比較</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="Chapter6.html"><a href="Chapter6.html#観察開始からの時間に基づく方法"><i class="fa fa-check"></i><b>6.3</b> 観察開始からの時間に基づく方法</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="Chapter6.html"><a href="Chapter6.html#モデルの概要-7"><i class="fa fa-check"></i><b>6.3.1</b> モデルの概要</a></li>
<li class="chapter" data-level="6.3.2" data-path="Chapter6.html"><a href="Chapter6.html#rでの実装-8"><i class="fa fa-check"></i><b>6.3.2</b> Rでの実装</a></li>
<li class="chapter" data-level="6.3.3" data-path="Chapter6.html"><a href="Chapter6.html#観察開始時点からの時間を使う利点"><i class="fa fa-check"></i><b>6.3.3</b> 観察開始時点からの時間を使う利点</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="Chapter6.html"><a href="Chapter6.html#分析モデルの拡張"><i class="fa fa-check"></i><b>6.4</b> 分析モデルの拡張</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="Chapterx.html"><a href="Chapterx.html"><i class="fa fa-check"></i>補遺 ノンパラメトリックな推定</a>
<ul>
<li class="chapter" data-level="" data-path="Chapterx.html"><a href="Chapterx.html#kaplan-meier法"><i class="fa fa-check"></i>Kaplan-Meier法</a></li>
<li class="chapter" data-level="" data-path="Chapterx.html"><a href="Chapterx.html#nelson-aalen法"><i class="fa fa-check"></i>Nelson-Aalen法</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="sessioninfo.html"><a href="sessioninfo.html"><i class="fa fa-check"></i>実行環境</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Event History and Survival Analysis Using R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="c4" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">4</span> コックス回帰モデル<a href="Chapter4.html#c4" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>前章(<a href="Chapter3.html#c3">3</a>)で解説したパラメトリックモデルは非常に有効である一方で以下の2点の欠点もあった。</p>
<ol style="list-style-type: decimal">
<li>最も適切な分布を決めなくてはならず、それがしばしば難しい<br />
</li>
<li>時間依存的な独立変数を使うことができない</li>
</ol>
<p>コックスの比例ハザードモデル<span class="citation">(<a href="#ref-Cox1972">Cox, 1972</a>)</span> (<strong>コックス回帰モデル</strong>)はこうした欠点をどちらも解決してくれる優れた分析手法である。</p>
<div id="比例ハザードモデル" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> 比例ハザードモデル<a href="Chapter4.html#比例ハザードモデル" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="モデルの概要-1" class="section level3 hasAnchor" number="4.1.1">
<h3><span class="header-section-number">4.1.1</span> モデルの概要<a href="Chapter4.html#モデルの概要-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>コックス回帰モデルはこれまで説明した<strong>パラメトリックな比例ハザードモデルを一般化したもの</strong>といえる。ひとまず、非時間依存な独立変数2つを持つモデルを考えると、比例ハザードモデルは以下のように書ける(式<a href="Chapter4.html#eq:eq-cox">(4.1)</a>)。ここで、<span class="math inline">\(a(t)\)</span>は時間の関数であり、どんな形でもよい。この形を一定の形に決める必要がないので、このモデルはしばしば「セミパラメトリック」なモデルと呼ばれる<a href="#fn11" class="footnote-ref" id="fnref11"><sup>11</sup></a>。</p>
<p><span class="math display" id="eq:eq-cox">\[
log(h(t)) = a(t) + b_1x_1 + b_2x_2 \tag{4.1}
\]</span></p>
<p>任意の時間<span class="math inline">\(t\)</span>に対して、個体<span class="math inline">\(i\)</span>と<span class="math inline">\(j\)</span>のハザード比(<span class="math inline">\(h_i(t)/h_j(t)\)</span>)の値が一定なので比例ハザードモデルといわれている。個体Aのハザード率を<span class="math inline">\(h_A(t)\)</span>、個体<span class="math inline">\(B\)</span>のハザード率を<span class="math inline">\(h_B(t)\)</span>とするとき、式<a href="Chapter4.html#eq:eq-cox">(4.1)</a>より以下のように導ける。このように、ハザード比は<span class="math inline">\(t\)</span>に依らず一定になる。<br />
<span class="math display">\[
\begin{align}
\frac{h_A(t)}{h_B(t)} &amp;= \frac{exp(a(t) + b_1x_{1A} + b_2x_{2A})}{exp(a(t) + b_1x_{1A} + b_2x_{2B})}\\
                      &amp;= \frac{e^{a(t)} \times e^{b_1} \times e^{x_{1A}} \times e^{b_2} \times e^{x_{2A}}}{e^{a(t)} \times e^{b_1} \times e^{x_{1B}} \times e^{b_2} \times e^{x_{2B}}}\\
                      &amp;= \frac{e^{x_{1A}+x_{2A}}}{e^{x_{1B}+x_{2B}}}
\end{align}
\]</span></p>
<p>第<a href="Chapter3.html#c3">3</a>章のパラメトリックなモデルはコックス回帰モデルの特殊例である。<span class="math inline">\(a(t)\)</span>が定数なら指数分布モデル、<span class="math inline">\(a(t) = ct\)</span>ならワイブル回帰モデルになる。<span class="math inline">\(a(t)\)</span>はいかなる形も取れるので、例えば以下のような4次の多項式にすることもできる(式<a href="Chapter4.html#eq:eq-cox2">(4.2)</a>)。</p>
<p><span class="math display" id="eq:eq-cox2">\[
a(t) = a_0 + a_1t + a_2t^2 + a_3t^3 + a_4t^4 \tag{4.2}
\]</span></p>
</div>
<div id="部分尤度法" class="section level3 hasAnchor" number="4.1.2">
<h3><span class="header-section-number">4.1.2</span> 部分尤度法<a href="Chapter4.html#部分尤度法" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>コックス回帰モデルでは<strong>部分尤度法</strong>と呼ばれる方法でパラメータの推定を行う。この方法では、尤度関数を偏回帰係数(<span class="math inline">\(b_1,b_2\)</span>)のみを含む部分と偏回帰係数と関数<span class="math inline">\(a(t)\)</span>の両方を含む部分に分解し、前者のみに着目して通常のパラメータ推定を行う。つまり、時間<span class="math inline">\(t\)</span>に依存する部分を無視して偏回帰係数のみを推定できるのである。部分尤度法では正確な事象の発生時間ではなく、事象の発生順序のみに基づいて推定が行われるため、時間を二乗したり整数倍しても推定結果は変わらない。詳しい解説は <span class="citation">Allison (<a href="#ref-Allison2014">2014</a>)</span> を参照。</p>
</div>
<div id="rによる実装" class="section level3 hasAnchor" number="4.1.3">
<h3><span class="header-section-number">4.1.3</span> Rによる実装<a href="Chapter4.html#rによる実装" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>第<a href="Chapter3.html#c3">3</a>章で分析した元服役囚の再犯データにコックス回帰モデルを当てはめる。分析には、<code>survival</code>パッケージの<code>coxph()</code>関数を使用する。</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="Chapter4.html#cb50-1" tabindex="-1"></a>mod_cox <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(week, arrest) <span class="sc">~</span> fin <span class="sc">+</span> age <span class="sc">+</span> race <span class="sc">+</span> wexp <span class="sc">+</span> mar </span>
<span id="cb50-2"><a href="Chapter4.html#cb50-2" tabindex="-1"></a>                 <span class="sc">+</span> paro <span class="sc">+</span> prio, <span class="at">data =</span> recid)</span></code></pre></div>
<p>結果は以下の通り。係数の推定値自体はワイブル回帰モデルとほとんど変わらない(表<a href="Chapter3.html#tab:tab-modelcomparison2">3.3</a>参照)。指数変換された標準偏回帰係数はパラメトリックなモデルと同様にハザード比として解釈できる。例えば、経済的支援を受けた元服役囚は受けてない元服役囚よりも再犯の可能性が約32%低下することが分かる。</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="Chapter4.html#cb51-1" tabindex="-1"></a>mod_cox</span></code></pre></div>
<pre><code>## Call:
## coxph(formula = Surv(week, arrest) ~ fin + age + race + wexp + 
##     mar + paro + prio, data = recid)
## 
##          coef exp(coef) se(coef)      z       p
## fin  -0.37942   0.68426  0.19138 -1.983 0.04742
## age  -0.05744   0.94418  0.02200 -2.611 0.00903
## race  0.31390   1.36875  0.30799  1.019 0.30812
## wexp -0.14980   0.86088  0.21222 -0.706 0.48029
## mar  -0.43370   0.64810  0.38187 -1.136 0.25606
## paro -0.08487   0.91863  0.19576 -0.434 0.66461
## prio  0.09150   1.09581  0.02865  3.194 0.00140
## 
## Likelihood ratio test=33.27  on 7 df, p=2.362e-05
## n= 432, number of events= 114</code></pre>
<p><code>survminer</code>パッケージの<code>ggforest()</code>関数で結果を図示することもできる(図<a href="Chapter4.html#fig:fig-res-cox">4.1</a>)。推定されたハザード比と95%信頼区間、検定結果が示されている。</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="Chapter4.html#cb53-1" tabindex="-1"></a><span class="fu">ggforest</span>(mod_cox)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-res-cox"></span>
<img src="SurvivalAnalysis_Using_R_files/figure-html/fig-res-cox-1.png" alt="mod_coxで推定されたハザード比" width="864" />
<p class="caption">
図4.1: mod_coxで推定されたハザード比
</p>
</div>
</div>
</div>
<div id="時間に依存する独立変数を含むコックス回帰" class="section level2 hasAnchor" number="4.2">
<h2><span class="header-section-number">4.2</span> 時間に依存する独立変数を含むコックス回帰<a href="Chapter4.html#時間に依存する独立変数を含むコックス回帰" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="モデルの概要-2" class="section level3 hasAnchor" number="4.2.1">
<h3><span class="header-section-number">4.2.1</span> モデルの概要<a href="Chapter4.html#モデルの概要-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>コックス回帰モデルは時間依存的な独立変数を含むモデルに拡張できる(式<a href="Chapter4.html#eq:eq-cox3">(4.3)</a>)。</p>
<p><span class="math display" id="eq:eq-cox3">\[
log(h(t)) = a(t) + b_1x_1 + b_2x_2(t)  \tag{4.3}
\]</span></p>
<p>独立変数の値の変化とそれがハザード率に与える影響の間にタイムラグがある場合は、例えば以下のように1週間前の値を独立変数にするようにモデリングすることもできる(式<a href="Chapter4.html#eq:eq-cox4">(4.4)</a>)。</p>
<p><span class="math display" id="eq:eq-cox4">\[
log(h(t)) = a(t) + b_1x_1 + b_2x_2(t-1)  \tag{4.4} 　　
\]</span></p>
</div>
<div id="rでの実装-3" class="section level3 hasAnchor" number="4.2.2">
<h3><span class="header-section-number">4.2.2</span> Rでの実装<a href="Chapter4.html#rでの実装-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>再犯データのモデルの独立変数に、各週の就業状況(<code>work</code>)を加えてモデリングを行う。Rで分析を行う際には、それぞれの人の各週のデータすべてが1行ずつあるようなデータフレームを作成する必要がある。</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="Chapter4.html#cb54-1" tabindex="-1"></a>recid <span class="sc">%&gt;%</span> </span>
<span id="cb54-2"><a href="Chapter4.html#cb54-2" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;id&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb54-3"><a href="Chapter4.html#cb54-3" tabindex="-1"></a>  <span class="do">### 就業状態を一列に</span></span>
<span id="cb54-4"><a href="Chapter4.html#cb54-4" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> work1<span class="sc">:</span>work52,</span>
<span id="cb54-5"><a href="Chapter4.html#cb54-5" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;work_week&quot;</span>,</span>
<span id="cb54-6"><a href="Chapter4.html#cb54-6" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;work&quot;</span>,</span>
<span id="cb54-7"><a href="Chapter4.html#cb54-7" tabindex="-1"></a>               <span class="at">values_drop_na =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb54-8"><a href="Chapter4.html#cb54-8" tabindex="-1"></a>  <span class="fu">arrange</span>(id) <span class="sc">%&gt;%</span> </span>
<span id="cb54-9"><a href="Chapter4.html#cb54-9" tabindex="-1"></a>  <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span></span>
<span id="cb54-10"><a href="Chapter4.html#cb54-10" tabindex="-1"></a>  <span class="do">## 各行データの観察開始時点</span></span>
<span id="cb54-11"><a href="Chapter4.html#cb54-11" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">start =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>() <span class="sc">-</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb54-12"><a href="Chapter4.html#cb54-12" tabindex="-1"></a>  <span class="do">## 各行データの観察終了時点(何週目か)  </span></span>
<span id="cb54-13"><a href="Chapter4.html#cb54-13" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">stop =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb54-14"><a href="Chapter4.html#cb54-14" tabindex="-1"></a>  <span class="do">## 再犯があった州のarrestのみを1にして、そのほかは0にする  </span></span>
<span id="cb54-15"><a href="Chapter4.html#cb54-15" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">arrest =</span> <span class="fu">ifelse</span>(arrest <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> week <span class="sc">==</span> stop,<span class="dv">1</span>,<span class="dv">0</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb54-16"><a href="Chapter4.html#cb54-16" tabindex="-1"></a>  <span class="do">##1週前の就業状態  </span></span>
<span id="cb54-17"><a href="Chapter4.html#cb54-17" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">worklag =</span> <span class="fu">lag</span>(work,<span class="dv">1</span>))<span class="ot">-&gt;</span> recid_long</span></code></pre></div>
<p>それでは、時間依存変数を含んだコックス回帰モデルを実行する。まずは式<a href="Chapter4.html#eq:eq-cox3">(4.3)</a>のモデルを推定する。従属変数は、<code>Surv(start, stop, arrest)</code>となる点に注意。</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="Chapter4.html#cb55-1" tabindex="-1"></a>mod_cox_ti <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(start, stop, arrest) <span class="sc">~</span> fin <span class="sc">+</span> age <span class="sc">+</span> race <span class="sc">+</span> wexp <span class="sc">+</span> mar </span>
<span id="cb55-2"><a href="Chapter4.html#cb55-2" tabindex="-1"></a>                 <span class="sc">+</span> paro <span class="sc">+</span> prio <span class="sc">+</span> work, <span class="at">data =</span> recid_long)</span></code></pre></div>
<p>結果は以下の通り。</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="Chapter4.html#cb56-1" tabindex="-1"></a>mod_cox_ti</span></code></pre></div>
<pre><code>## Call:
## coxph(formula = Surv(start, stop, arrest) ~ fin + age + race + 
##     wexp + mar + paro + prio + work, data = recid_long)
## 
##          coef exp(coef) se(coef)      z        p
## fin  -0.35672   0.69997  0.19113 -1.866  0.06198
## age  -0.04634   0.95472  0.02174 -2.132  0.03301
## race  0.33866   1.40306  0.30960  1.094  0.27402
## wexp -0.02555   0.97477  0.21142 -0.121  0.90380
## mar  -0.29375   0.74546  0.38303 -0.767  0.44314
## paro -0.06421   0.93781  0.19468 -0.330  0.74156
## prio  0.08514   1.08887  0.02896  2.940  0.00328
## work -1.32832   0.26492  0.25072 -5.298 1.17e-07
## 
## Likelihood ratio test=68.65  on 8 df, p=9.114e-12
## n= 19809, number of events= 114</code></pre>
<p><code>ggforest()</code>関数によって図示した結果が図<a href="Chapter4.html#fig:fig-res-coxti">4.2</a>である。</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="Chapter4.html#cb58-1" tabindex="-1"></a><span class="fu">ggforest</span>(mod_cox_ti)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-res-coxti"></span>
<img src="SurvivalAnalysis_Using_R_files/figure-html/fig-res-coxti-1.png" alt="mod_coxで推定されたハザード比" width="864" />
<p class="caption">
図4.2: mod_coxで推定されたハザード比
</p>
</div>
<p>続いて、式<a href="Chapter4.html#eq:eq-cox4">(4.4)</a>のモデルを推定する。<code>work</code>の代わりに<code>worklag</code>を説明変数に入れる。</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="Chapter4.html#cb59-1" tabindex="-1"></a>mod_cox_tlag <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(start, stop, arrest) <span class="sc">~</span> fin <span class="sc">+</span> age <span class="sc">+</span> race <span class="sc">+</span> wexp <span class="sc">+</span> mar </span>
<span id="cb59-2"><a href="Chapter4.html#cb59-2" tabindex="-1"></a>                 <span class="sc">+</span> paro <span class="sc">+</span> prio <span class="sc">+</span> worklag, <span class="at">data =</span> recid_long)</span></code></pre></div>
<p>結果は以下の通り。</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="Chapter4.html#cb60-1" tabindex="-1"></a>mod_cox_tlag</span></code></pre></div>
<pre><code>## Call:
## coxph(formula = Surv(start, stop, arrest) ~ fin + age + race + 
##     wexp + mar + paro + prio + worklag, data = recid_long)
## 
##             coef exp(coef) se(coef)      z        p
## fin     -0.35130   0.70377  0.19181 -1.831 0.067035
## age     -0.04977   0.95144  0.02189 -2.274 0.022969
## race     0.32147   1.37915  0.30912  1.040 0.298369
## wexp    -0.04764   0.95348  0.21323 -0.223 0.823207
## mar     -0.34476   0.70839  0.38322 -0.900 0.368310
## paro    -0.04710   0.95399  0.19630 -0.240 0.810375
## prio     0.09199   1.09635  0.02880  3.194 0.001402
## worklag -0.78689   0.45526  0.21808 -3.608 0.000308
## 
## Likelihood ratio test=47.16  on 8 df, p=1.43e-07
## n= 19377, number of events= 113 
##    (432 observations deleted due to missingness)</code></pre>
<p><code>ggforest()</code>関数によって図示した結果が図<a href="Chapter4.html#fig:fig-res-coxtlag">4.3</a>である。</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="Chapter4.html#cb62-1" tabindex="-1"></a><span class="fu">ggforest</span>(mod_cox_tlag)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-res-coxtlag"></span>
<img src="SurvivalAnalysis_Using_R_files/figure-html/fig-res-coxtlag-1.png" alt="mod_coxで推定されたハザード比" width="864" />
<p class="caption">
図4.3: mod_coxで推定されたハザード比
</p>
</div>
</div>
<div id="モデルの比較" class="section level3 hasAnchor" number="4.2.3">
<h3><span class="header-section-number">4.2.3</span> モデルの比較<a href="Chapter4.html#モデルの比較" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>推定した3つのモデルの推定値をまとめたものが表<a href="Chapter4.html#tab:tab-coxmodelcomp">4.1</a>である。推定結果自体は非常によく似ているが、先ほどの検定結果を見ると経済的支援の効果は時間依存変数を含まない基本モデルのみで有意になっている。また、時間依存変数の就業状態(<code>work</code>または<code>worklag</code>)が他の変数よりも大きな影響を与えていたことも分かった。、2つ目のモデルのハザード比(<code>Exp(Coef) = 0.265</code>)をみると就業している元服役囚の再犯率が就業していない服役囚の26.5%であると推定された。</p>
<p>ただし、この結果のみでは就業状態が再犯に影響したのか、再犯が就業状態に影響したのかはわからない。そこで、就業状態に1週間のラグがあるモデル3の結果を見ると、2つ目のモデルより効果量は減少するものの、依然として大きな影響を及ぼしていることが分かる。モデル3のハザード比(<code>Exp(Coef) = 0.455</code>)から、就業状態にある元服役囚はそうでない元服役囚に比べて翌週の再犯率が約54.5%低いことが分かる。このように、タイムラグを持つ変数を用いることで再犯が就業状態に影響する可能性を除外することができる。</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="Chapter4.html#cb63-1" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">Covariate =</span> <span class="fu">rownames</span>(mod_cox_ti<span class="sc">$</span>coefficients <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>()),</span>
<span id="cb63-2"><a href="Chapter4.html#cb63-2" tabindex="-1"></a>       <span class="st">&quot;Coef(basic)&quot;</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">sprintf</span>(<span class="st">&quot;%.3f&quot;</span>,<span class="fu">coef</span>(mod_cox))[<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>],<span class="cn">NA</span>),</span>
<span id="cb63-3"><a href="Chapter4.html#cb63-3" tabindex="-1"></a>       <span class="st">&quot;Exp(Coef_basic)&quot;</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">sprintf</span>(<span class="st">&quot;%.3f&quot;</span>,<span class="fu">exp</span>(<span class="fu">coef</span>(mod_cox)))[<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>],<span class="cn">NA</span>),</span>
<span id="cb63-4"><a href="Chapter4.html#cb63-4" tabindex="-1"></a>       <span class="st">&quot;Coef(ti)&quot;</span> <span class="ot">=</span> <span class="fu">sprintf</span>(<span class="st">&quot;%.3f&quot;</span>,<span class="fu">coef</span>(mod_cox_ti))[<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>],</span>
<span id="cb63-5"><a href="Chapter4.html#cb63-5" tabindex="-1"></a>       <span class="st">&quot;Exp(Coef_ti)&quot;</span> <span class="ot">=</span> <span class="fu">sprintf</span>(<span class="st">&quot;%.3f&quot;</span>,<span class="fu">exp</span>(<span class="fu">coef</span>(mod_cox_ti)))[<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>],</span>
<span id="cb63-6"><a href="Chapter4.html#cb63-6" tabindex="-1"></a>       <span class="st">&quot;Coef(tlag)&quot;</span> <span class="ot">=</span> <span class="fu">sprintf</span>(<span class="st">&quot;%.3f&quot;</span>,<span class="fu">coef</span>(mod_cox_tlag))[<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>],</span>
<span id="cb63-7"><a href="Chapter4.html#cb63-7" tabindex="-1"></a>       <span class="st">&quot;Exp(Coef_tlag)&quot;</span> <span class="ot">=</span> <span class="fu">sprintf</span>(<span class="st">&quot;%.3f&quot;</span>,<span class="fu">exp</span>(<span class="fu">coef</span>(mod_cox_tlag))[<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>])) <span class="sc">%&gt;%</span> </span>
<span id="cb63-8"><a href="Chapter4.html#cb63-8" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Covariate =</span> <span class="fu">ifelse</span>(<span class="fu">str_detect</span>(Covariate,<span class="st">&quot;work&quot;</span>),<span class="st">&quot;work/worklag&quot;</span>,Covariate)) <span class="sc">%&gt;%</span> </span>
<span id="cb63-9"><a href="Chapter4.html#cb63-9" tabindex="-1"></a>  <span class="fu">flextable</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb63-10"><a href="Chapter4.html#cb63-10" tabindex="-1"></a>  <span class="fu">add_header_row</span>(<span class="at">colwidth =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>),</span>
<span id="cb63-11"><a href="Chapter4.html#cb63-11" tabindex="-1"></a>                 <span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;&quot;</span>,<span class="st">&quot;基本モデル&quot;</span>,<span class="st">&quot;時間依存独立変数</span><span class="sc">\n</span><span class="st">あり&quot;</span>, <span class="st">&quot;タイムラグのある</span><span class="sc">\n</span><span class="st">時間独立変数あり&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb63-12"><a href="Chapter4.html#cb63-12" tabindex="-1"></a>  flextable<span class="sc">::</span><span class="fu">align</span>(<span class="at">align =</span> <span class="st">&quot;center&quot;</span>, <span class="at">part =</span> <span class="st">&quot;all&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb63-13"><a href="Chapter4.html#cb63-13" tabindex="-1"></a>  <span class="fu">set_caption</span>(<span class="st">&quot;各モデルの推定値の比較&quot;</span>)</span></code></pre></div>
<div class="tabwid"><style>.cl-8b5576bc{}.cl-8b4e85d2{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-8b5193da{margin:0;text-align:center;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-8b51a8de{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-8b51a8df{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-8b51a8e8{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-8b5576bc'>

<caption style="display:table-caption;margin:0pt;text-align:center;border-bottom: 0.00pt solid transparent;border-top: 0.00pt solid transparent;border-left: 0.00pt solid transparent;border-right: 0.00pt solid transparent;padding-top:3pt;padding-bottom:3pt;padding-left:3pt;padding-right:3pt;line-height: 1;background-color:transparent;">
<span id="tab:tab-coxmodelcomp">表4.1: </span><span>各モデルの推定値の比較</span>
</caption>

<thead><tr style="overflow-wrap:break-word;"><th class="cl-8b51a8de"><p class="cl-8b5193da"><span class="cl-8b4e85d2"></span></p></th><th  colspan="2"class="cl-8b51a8de"><p class="cl-8b5193da"><span class="cl-8b4e85d2">基本モデル</span></p></th><th  colspan="2"class="cl-8b51a8de"><p class="cl-8b5193da"><span class="cl-8b4e85d2">時間依存独立変数</span><br><span class="cl-8b4e85d2">あり</span></p></th><th  colspan="2"class="cl-8b51a8de"><p class="cl-8b5193da"><span class="cl-8b4e85d2">タイムラグのある</span><br><span class="cl-8b4e85d2">時間独立変数あり</span></p></th></tr><tr style="overflow-wrap:break-word;"><th class="cl-8b51a8de"><p class="cl-8b5193da"><span class="cl-8b4e85d2">Covariate</span></p></th><th class="cl-8b51a8de"><p class="cl-8b5193da"><span class="cl-8b4e85d2">Coef(basic)</span></p></th><th class="cl-8b51a8de"><p class="cl-8b5193da"><span class="cl-8b4e85d2">Exp(Coef_basic)</span></p></th><th class="cl-8b51a8de"><p class="cl-8b5193da"><span class="cl-8b4e85d2">Coef(ti)</span></p></th><th class="cl-8b51a8de"><p class="cl-8b5193da"><span class="cl-8b4e85d2">Exp(Coef_ti)</span></p></th><th class="cl-8b51a8de"><p class="cl-8b5193da"><span class="cl-8b4e85d2">Coef(tlag)</span></p></th><th class="cl-8b51a8de"><p class="cl-8b5193da"><span class="cl-8b4e85d2">Exp(Coef_tlag)</span></p></th></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">fin</span></p></td><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">-0.379</span></p></td><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">0.684</span></p></td><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">-0.357</span></p></td><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">0.700</span></p></td><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">-0.351</span></p></td><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">0.704</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">age</span></p></td><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">-0.057</span></p></td><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">0.944</span></p></td><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">-0.046</span></p></td><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">0.955</span></p></td><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">-0.050</span></p></td><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">0.951</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">race</span></p></td><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">0.314</span></p></td><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">1.369</span></p></td><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">0.339</span></p></td><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">1.403</span></p></td><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">0.321</span></p></td><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">1.379</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">wexp</span></p></td><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">-0.150</span></p></td><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">0.861</span></p></td><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">-0.026</span></p></td><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">0.975</span></p></td><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">-0.048</span></p></td><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">0.953</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">mar</span></p></td><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">-0.434</span></p></td><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">0.648</span></p></td><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">-0.294</span></p></td><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">0.745</span></p></td><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">-0.345</span></p></td><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">0.708</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">paro</span></p></td><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">-0.085</span></p></td><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">0.919</span></p></td><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">-0.064</span></p></td><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">0.938</span></p></td><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">-0.047</span></p></td><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">0.954</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">prio</span></p></td><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">0.091</span></p></td><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">1.096</span></p></td><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">0.085</span></p></td><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">1.089</span></p></td><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">0.092</span></p></td><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">1.096</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-8b51a8e8"><p class="cl-8b5193da"><span class="cl-8b4e85d2">work/worklag</span></p></td><td class="cl-8b51a8e8"><p class="cl-8b5193da"><span class="cl-8b4e85d2"></span></p></td><td class="cl-8b51a8e8"><p class="cl-8b5193da"><span class="cl-8b4e85d2"></span></p></td><td class="cl-8b51a8e8"><p class="cl-8b5193da"><span class="cl-8b4e85d2">-1.328</span></p></td><td class="cl-8b51a8e8"><p class="cl-8b5193da"><span class="cl-8b4e85d2">0.265</span></p></td><td class="cl-8b51a8e8"><p class="cl-8b5193da"><span class="cl-8b4e85d2">-0.787</span></p></td><td class="cl-8b51a8e8"><p class="cl-8b5193da"><span class="cl-8b4e85d2">0.455</span></p></td></tr></tbody></table></div>
<p><br/></p>
</div>
<div id="データに欠損がある場合の補完と加工" class="section level3 hasAnchor" number="4.2.4">
<h3><span class="header-section-number">4.2.4</span> データに欠損がある場合の補完と加工<a href="Chapter4.html#データに欠損がある場合の補完と加工" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>時間依存独立変数があるモデルの推定をするとき、ある時点で事象が発生した場合、<strong>その時点で事象を経験しうるすべての個体について時間依存変数の値が分かっていなければいけない</strong>。例えば、<span class="math inline">\(t =10\)</span>で事象が発生し、その時点で15人が事象を経験する可能性がある(= リスク集合にいる)場合、15人全員について<span class="math inline">\(t=10\)</span>時点の時間依存変数が分かっていなければいけない。そのため、事象の発生が日単位で測定されているにもかかわらず、時間依存変数の値が1週間ごとにしか測定されていないといったことがあるとき、問題が生じることになる。</p>
<p>このような場合、特定の方法で事象が発生した時点の独立変数の値を<strong>補完して代入</strong>する必要がある。いろいろな方法があるが、最も安全なものは直前に観察された値を使用する方法である。保管によって必要な代入ができたら、次に分析のためにデータを加工する必要がある。加工方法には以下の2つがあるが、統計ソフトではいずれかを使用している(Rはエピソード分割法)。どちらも選べるならば後者の方が望ましい。</p>
<div id="プログラミングステートメント法programming-statements-method" class="section level4 hasAnchor" number="4.2.4.1">
<h4><span class="header-section-number">4.2.4.1</span> プログラミング・ステートメント法(programming statements method)<a href="Chapter4.html#プログラミングステートメント法programming-statements-method" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>この方法を使用するには、データをワイド形式にする必要がある。すなわち、今回の例では各週の就業状態が1列ずつになるようにする必要がある。</p>
</div>
<div id="エピソード分割法episode-splitting-method" class="section level4 hasAnchor" number="4.2.4.2">
<h4><span class="header-section-number">4.2.4.2</span> エピソード分割法(episode splitting method)<a href="Chapter4.html#エピソード分割法episode-splitting-method" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>この方法のデータは先ほど加工した<code>recid_long</code>のようにロング形式で問題ない。それぞれの個体が複数の行を持ち、各行のデータについて観察し始めた時点(<code>start</code>)と観察が終了した時点(<code>stop</code>)を記した列を作る。また独立変数が変化するたびに行を変えるか、もしくは独立変数の変化に関係なく小さな時間間隔ごとに行を変える(どちらでも問題ない)。例えば<code>recid_long</code>では各個体が1週間ごとに1行ずつのデータを持つ。</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="Chapter4.html#cb64-1" tabindex="-1"></a>recid_long <span class="sc">%&gt;%</span> </span>
<span id="cb64-2"><a href="Chapter4.html#cb64-2" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">50</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb64-3"><a href="Chapter4.html#cb64-3" tabindex="-1"></a>  <span class="fu">datatable</span>(<span class="at">options =</span> <span class="fu">list</span>(<span class="at">scrollX =</span> <span class="dv">20</span>))</span></code></pre></div>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-57e23d45764d455cb295" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-57e23d45764d455cb295">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50"],["1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","10","10","10","10","10","10","10","10","10","10","10","10","10","10","10","10","10","10","10","10","10","10","10","10","10","10","10","10","10","10"],[20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],["work1","work2","work3","work4","work5","work6","work7","work8","work9","work10","work11","work12","work13","work14","work15","work16","work17","work18","work19","work20","work1","work2","work3","work4","work5","work6","work7","work8","work9","work10","work11","work12","work13","work14","work15","work16","work17","work18","work19","work20","work21","work22","work23","work24","work25","work26","work27","work28","work29","work30"],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29],[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30],[null,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,null,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>id<\/th>\n      <th>week<\/th>\n      <th>arrest<\/th>\n      <th>fin<\/th>\n      <th>age<\/th>\n      <th>race<\/th>\n      <th>wexp<\/th>\n      <th>mar<\/th>\n      <th>paro<\/th>\n      <th>prio<\/th>\n      <th>educ<\/th>\n      <th>work_week<\/th>\n      <th>work<\/th>\n      <th>start<\/th>\n      <th>stop<\/th>\n      <th>worklag<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"scrollX":20,"columnDefs":[{"className":"dt-right","targets":[2,3,4,5,6,7,8,9,10,11,13,14,15,16]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
<div id="比例ハザード性の仮定の検討と修正" class="section level2 hasAnchor" number="4.3">
<h2><span class="header-section-number">4.3</span> 比例ハザード性の仮定の検討と修正<a href="Chapter4.html#比例ハザード性の仮定の検討と修正" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="シェーンフィールド残差を用いた検討" class="section level3 hasAnchor" number="4.3.1">
<h3><span class="header-section-number">4.3.1</span> シェーンフィールド残差を用いた検討<a href="Chapter4.html#シェーンフィールド残差を用いた検討" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>コックス回帰モデルの仮定として、どの時点でも2個体のハザード比が一定であるとする「比例ハザード性」があった。この仮定が満たされないときはどのようなときだろうか?</p>
<p>ハザード比が一定になるのは、ハザード率の対数に対して各独立変数の影響が全ての時点で同じときである。そのため、時間と独立変数に交互作用があるときはハザード率の比は一定にならない。式<a href="Chapter4.html#eq:eq-cox-int">(4.5)</a>はその一例である。この式で独立変数<span class="math inline">\(x\)</span>がハザード率の対数に与える影響は<span class="math inline">\(b + ct\)</span>なので、時間と共に増加/減少する。</p>
<p><span class="math display" id="eq:eq-cox-int">\[
log(h(t)) = a(t) + bx + cxt \tag{4.5}
\]</span></p>
<p>比例ハザード性を検討する方法はいくつかあるが、最も簡便なものは<strong>シェーンフィールド残差</strong>を用いる方法である。子の残差は独立変数の一つ一つに対して研鑽され、比例ハザード性が満たされるならば時間、あるいは時間の関数と相関がない。</p>
<p>Rでシェーンフィールド残差を調べるためには、以下のようなコードを実行する。ここでは、2つ目のモデル(<code>mod_cox_ti</code>)について分析を行う。<code>chisq</code>の列には「相関係数が0である」を帰無仮説とする検定を行った際のカイ二乗値が、<code>p</code>にはp値が示されている。年齢(<code>age</code>)はp値が0.05を下回っており、比例ハザード性の仮定を満たしていない可能性が示唆された。一番下には「全ての相関係数が0である」を帰無仮説とする包括的検定(<code>GLOBAL</code>)が行われており、これも5%水準で有意である。</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="Chapter4.html#cb65-1" tabindex="-1"></a><span class="fu">cox.zph</span>(mod_cox_ti, <span class="at">transform =</span> <span class="st">&quot;identity&quot;</span>) </span></code></pre></div>
<pre><code>##          chisq df     p
## fin     0.0143  1 0.905
## age     6.5021  1 0.011
## race    1.9489  1 0.163
## wexp    3.5032  1 0.061
## mar     0.8508  1 0.356
## paro    0.0118  1 0.913
## prio    0.3363  1 0.562
## work    0.1972  1 0.657
## GLOBAL 17.1128  8 0.029</code></pre>
<p><code>survminer</code>パッケージの<code>ggcoxzph</code>をもちいて視覚的に仮定をチェックすることもできる(図<a href="Chapter4.html#fig:fig-coxcheck">4.4</a>)。</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="Chapter4.html#cb67-1" tabindex="-1"></a><span class="fu">ggcoxzph</span>(<span class="fu">cox.zph</span>(mod_cox_ti, <span class="at">transform =</span> <span class="st">&quot;identity&quot;</span>) )</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-coxcheck"></span>
<img src="SurvivalAnalysis_Using_R_files/figure-html/fig-coxcheck-1.png" alt="各独立変数の比例ハザード性のチェック" width="672" />
<p class="caption">
図4.4: 各独立変数の比例ハザード性のチェック
</p>
</div>
<p>なお、比例ハザード性が満たされるためには実際は時間そのものだけではなく、時間の関数(時間の対数や順位、および事象が発生した時間の累積分布関数の推定値など)とも無相関である必要である。Rでは、時間の順位と、Kaplan-meiyer法による生存確率の推定値(後述)との相関も調べることができる。結果はほとんど変わらない。</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="Chapter4.html#cb68-1" tabindex="-1"></a><span class="do">## 時間</span></span>
<span id="cb68-2"><a href="Chapter4.html#cb68-2" tabindex="-1"></a><span class="fu">cox.zph</span>(mod_cox_ti, <span class="at">transform =</span> <span class="st">&quot;rank&quot;</span>) </span></code></pre></div>
<pre><code>##          chisq df      p
## fin     0.0181  1 0.8929
## age     6.7334  1 0.0095
## race    1.9342  1 0.1643
## wexp    3.3284  1 0.0681
## mar     0.8976  1 0.3434
## paro    0.0166  1 0.8975
## prio    0.2838  1 0.5942
## work    0.1756  1 0.6752
## GLOBAL 17.1526  8 0.0286</code></pre>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="Chapter4.html#cb70-1" tabindex="-1"></a><span class="do">## 生存確率の推定値</span></span>
<span id="cb70-2"><a href="Chapter4.html#cb70-2" tabindex="-1"></a><span class="fu">cox.zph</span>(mod_cox_ti, <span class="at">transform =</span> <span class="st">&quot;km&quot;</span>) </span></code></pre></div>
<pre><code>##           chisq df     p
## fin    9.58e-04  1 0.975
## age    5.89e+00  1 0.015
## race   1.87e+00  1 0.171
## wexp   3.83e+00  1 0.050
## mar    8.29e-01  1 0.363
## paro   5.64e-03  1 0.940
## prio   4.27e-01  1 0.514
## work   2.50e-01  1 0.617
## GLOBAL 1.66e+01  8 0.034</code></pre>
</div>
<div id="仮定が満たされないときの修正" class="section level3 hasAnchor" number="4.3.2">
<h3><span class="header-section-number">4.3.2</span> 仮定が満たされないときの修正<a href="Chapter4.html#仮定が満たされないときの修正" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="時間との交互作用をモデルに加える" class="section level4 hasAnchor" number="4.3.2.1">
<h4><span class="header-section-number">4.3.2.1</span> 時間との交互作用をモデルに加える<a href="Chapter4.html#時間との交互作用をモデルに加える" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>仮定が満たされないときの解決策の一つは独立変数と時間の交互作用を含んだ式<a href="Chapter4.html#eq:eq-cox-int">(4.5)</a>のようなモデルを推定することである。コックス回帰モデルのすばらしさは、このように<strong>比例ハザード性を持たないモデルを柔軟に修正できる</strong>点である。ここでは、p値が0.1以下だった年齢(<code>age</code>)と過去の就業経験(<code>wexp</code>)について各データポイント時点の週(<code>stop</code>)との交互作用を入れたモデルを検討する。</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="Chapter4.html#cb72-1" tabindex="-1"></a>mod_cox_int <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(start, stop, arrest) <span class="sc">~</span> fin <span class="sc">+</span> age <span class="sc">+</span> race <span class="sc">+</span> wexp <span class="sc">+</span> mar </span>
<span id="cb72-2"><a href="Chapter4.html#cb72-2" tabindex="-1"></a>                 <span class="sc">+</span> paro <span class="sc">+</span> prio <span class="sc">+</span> work <span class="sc">+</span> age<span class="sc">:</span>stop <span class="sc">+</span> wexp<span class="sc">:</span>stop, <span class="at">data =</span> recid_long)</span></code></pre></div>
<p>結果は以下の通りである。いずれの交互作用も有意な影響を持っていることが分かる。</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="Chapter4.html#cb73-1" tabindex="-1"></a>mod_cox_int</span></code></pre></div>
<pre><code>## Call:
## coxph(formula = Surv(start, stop, arrest) ~ fin + age + race + 
##     wexp + mar + paro + prio + work + age:stop + wexp:stop, data = recid_long)
## 
##                coef exp(coef)  se(coef)      z        p
## fin       -0.361738  0.696465  0.190891 -1.895 0.058093
## age        0.085368  1.089118  0.040598  2.103 0.035484
## race       0.305627  1.357476  0.309442  0.988 0.323313
## wexp      -1.209155  0.298449  0.481342 -2.512 0.012003
## mar       -0.233974  0.791382  0.383910 -0.609 0.542226
## paro      -0.063033  0.938913  0.194910 -0.323 0.746398
## prio       0.080920  1.084284  0.028951  2.795 0.005188
## work      -1.318052  0.267656  0.251332 -5.244 1.57e-07
## age:stop  -0.005091  0.994922  0.001541 -3.304 0.000952
## wexp:stop  0.041276  1.042139  0.014512  2.844 0.004451
## 
## Likelihood ratio test=83.62  on 10 df, p=9.751e-14
## n= 19809, number of events= 114</code></pre>
<p>交互作用項については、一般化線形モデルなどと同様に解釈することができる<a href="#fn12" class="footnote-ref" id="fnref12"><sup>12</sup></a>。式<a href="Chapter4.html#eq:eq-cox-int">(4.5)</a>を書き換えると以下のように書ける。</p>
<p><span class="math display">\[
log(h(t)) = a(t) + (b+ct)x
\]</span></p>
<p>ここからわかるように、独立変数<span class="math inline">\(x\)</span>が1増えると、ハザード関数の対数は<span class="math inline">\(b+ct\)</span>増える。つまり、<span class="math inline">\(x\)</span>の「効果」は時間の線形関数になっていて、<u><span class="math inline">\(t=0\)</span>のときは<span class="math inline">\(b\)</span>でそこから時間が１単位増えるごとに効果が<span class="math inline">\(c\)</span>ずつ増えていく</u>ということになる。例えば先ほどの推定結果から、就業経験の有無の効果は<span class="math inline">\(-1.21 + 0.041 \times t\)</span>となり、効果が1週ごとに<span class="math inline">\(0.041\)</span>ずつ増加することが分かる。表<a href="Chapter4.html#tab:tab-cox-int">4.2</a>は、出所時の年齢(<code>age</code>)と就業経験の有無(<code>wexp</code>)の効果が時間がたつにつれてどのように変化すると推定されたかを示している。例えば<code>wexp</code>については、出所直後は就業経験があるとない場合に比べてハザード率が29.8%になることが分かるが、50週後にはむしろ就業経験があるとない場合に比べてハザード比が235%上昇することが分かり、このような効果の逆転は30週くらいで起こっていることが分かる。</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="Chapter4.html#cb75-1" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">t =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">50</span>,<span class="dv">10</span>),</span>
<span id="cb75-2"><a href="Chapter4.html#cb75-2" tabindex="-1"></a>       <span class="st">`</span><span class="at">偏回帰係数</span><span class="sc">\n</span><span class="at">(b + ct)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sprintf</span>(<span class="st">&quot;%.3f&quot;</span>,mod_cox_int<span class="sc">$</span>coefficients[[<span class="dv">2</span>]] <span class="sc">+</span> mod_cox_int<span class="sc">$</span>coefficients[[<span class="dv">9</span>]]<span class="sc">*</span>t),</span>
<span id="cb75-3"><a href="Chapter4.html#cb75-3" tabindex="-1"></a>         <span class="st">`</span><span class="at">Exp(b+ct)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sprintf</span>(<span class="st">&quot;%.3f&quot;</span>, <span class="fu">exp</span>(mod_cox_int<span class="sc">$</span>coefficients[[<span class="dv">2</span>]] <span class="sc">+</span> mod_cox_int<span class="sc">$</span>coefficients[[<span class="dv">9</span>]]<span class="sc">*</span>t)),</span>
<span id="cb75-4"><a href="Chapter4.html#cb75-4" tabindex="-1"></a>       <span class="st">`</span><span class="at">偏回帰係数</span><span class="sc">\n</span><span class="at">(b + ct) </span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sprintf</span>(<span class="st">&quot;%.3f&quot;</span>, mod_cox_int<span class="sc">$</span>coefficients[[<span class="dv">4</span>]] <span class="sc">+</span> mod_cox_int<span class="sc">$</span>coefficients[[<span class="dv">10</span>]]<span class="sc">*</span>t),</span>
<span id="cb75-5"><a href="Chapter4.html#cb75-5" tabindex="-1"></a>         <span class="st">`</span><span class="at">Exp(b+ct) </span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sprintf</span>(<span class="st">&quot;%.3f&quot;</span>, <span class="fu">exp</span>(mod_cox_int<span class="sc">$</span>coefficients[[<span class="dv">4</span>]] <span class="sc">+</span> mod_cox_int<span class="sc">$</span>coefficients[[<span class="dv">10</span>]]<span class="sc">*</span>t))) <span class="sc">%&gt;%</span> </span>
<span id="cb75-6"><a href="Chapter4.html#cb75-6" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">`</span><span class="at">出所して</span><span class="sc">\n</span><span class="at">からの週(t)</span><span class="st">`</span> <span class="ot">=</span> t) <span class="sc">%&gt;%</span> </span>
<span id="cb75-7"><a href="Chapter4.html#cb75-7" tabindex="-1"></a>  <span class="fu">flextable</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb75-8"><a href="Chapter4.html#cb75-8" tabindex="-1"></a>  <span class="fu">width</span>(<span class="at">width =</span> <span class="dv">2</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb75-9"><a href="Chapter4.html#cb75-9" tabindex="-1"></a>  <span class="fu">add_header_row</span>(<span class="at">colwidth =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>),</span>
<span id="cb75-10"><a href="Chapter4.html#cb75-10" tabindex="-1"></a>                 <span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;&quot;</span>,<span class="st">&quot;出所時の年齢&quot;</span>,<span class="st">&quot;就業経験の有無&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb75-11"><a href="Chapter4.html#cb75-11" tabindex="-1"></a>  flextable<span class="sc">::</span><span class="fu">align</span>(<span class="at">align =</span> <span class="st">&quot;center&quot;</span>, <span class="at">part =</span> <span class="st">&quot;all&quot;</span>)  <span class="sc">%&gt;%</span> </span>
<span id="cb75-12"><a href="Chapter4.html#cb75-12" tabindex="-1"></a>  <span class="fu">set_caption</span>(<span class="st">&quot;モデルから推定された交互作用項を含む偏回帰係数&quot;</span>)</span></code></pre></div>
<div class="tabwid"><style>.cl-9b607fe8{}.cl-9b59de40{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-9b5c95d6{margin:0;text-align:center;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-9b5cae2c{width:1in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-9b5cae36{width:1in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-9b5cae37{width:1in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-9b607fe8'>

<caption style="display:table-caption;margin:0pt;text-align:center;border-bottom: 0.00pt solid transparent;border-top: 0.00pt solid transparent;border-left: 0.00pt solid transparent;border-right: 0.00pt solid transparent;padding-top:3pt;padding-bottom:3pt;padding-left:3pt;padding-right:3pt;line-height: 1;background-color:transparent;">
<span id="tab:tab-cox-int">表4.2: </span><span>モデルから推定された交互作用項を含む偏回帰係数</span>
</caption>

<thead><tr style="overflow-wrap:break-word;"><th class="cl-9b5cae2c"><p class="cl-9b5c95d6"><span class="cl-9b59de40"></span></p></th><th  colspan="2"class="cl-9b5cae2c"><p class="cl-9b5c95d6"><span class="cl-9b59de40">出所時の年齢</span></p></th><th  colspan="2"class="cl-9b5cae2c"><p class="cl-9b5c95d6"><span class="cl-9b59de40">就業経験の有無</span></p></th></tr><tr style="overflow-wrap:break-word;"><th class="cl-9b5cae2c"><p class="cl-9b5c95d6"><span class="cl-9b59de40">出所して</span><br><span class="cl-9b59de40">からの週(t)</span></p></th><th class="cl-9b5cae2c"><p class="cl-9b5c95d6"><span class="cl-9b59de40">偏回帰係数</span><br><span class="cl-9b59de40">(b + ct)</span></p></th><th class="cl-9b5cae2c"><p class="cl-9b5c95d6"><span class="cl-9b59de40">Exp(b+ct)</span></p></th><th class="cl-9b5cae2c"><p class="cl-9b5c95d6"><span class="cl-9b59de40">偏回帰係数</span><br><span class="cl-9b59de40">(b + ct) </span></p></th><th class="cl-9b5cae2c"><p class="cl-9b5c95d6"><span class="cl-9b59de40">Exp(b+ct) </span></p></th></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-9b5cae36"><p class="cl-9b5c95d6"><span class="cl-9b59de40">0</span></p></td><td class="cl-9b5cae36"><p class="cl-9b5c95d6"><span class="cl-9b59de40">0.085</span></p></td><td class="cl-9b5cae36"><p class="cl-9b5c95d6"><span class="cl-9b59de40">1.089</span></p></td><td class="cl-9b5cae36"><p class="cl-9b5c95d6"><span class="cl-9b59de40">-1.209</span></p></td><td class="cl-9b5cae36"><p class="cl-9b5c95d6"><span class="cl-9b59de40">0.298</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-9b5cae36"><p class="cl-9b5c95d6"><span class="cl-9b59de40">10</span></p></td><td class="cl-9b5cae36"><p class="cl-9b5c95d6"><span class="cl-9b59de40">0.034</span></p></td><td class="cl-9b5cae36"><p class="cl-9b5c95d6"><span class="cl-9b59de40">1.035</span></p></td><td class="cl-9b5cae36"><p class="cl-9b5c95d6"><span class="cl-9b59de40">-0.796</span></p></td><td class="cl-9b5cae36"><p class="cl-9b5c95d6"><span class="cl-9b59de40">0.451</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-9b5cae36"><p class="cl-9b5c95d6"><span class="cl-9b59de40">20</span></p></td><td class="cl-9b5cae36"><p class="cl-9b5c95d6"><span class="cl-9b59de40">-0.016</span></p></td><td class="cl-9b5cae36"><p class="cl-9b5c95d6"><span class="cl-9b59de40">0.984</span></p></td><td class="cl-9b5cae36"><p class="cl-9b5c95d6"><span class="cl-9b59de40">-0.384</span></p></td><td class="cl-9b5cae36"><p class="cl-9b5c95d6"><span class="cl-9b59de40">0.681</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-9b5cae36"><p class="cl-9b5c95d6"><span class="cl-9b59de40">30</span></p></td><td class="cl-9b5cae36"><p class="cl-9b5c95d6"><span class="cl-9b59de40">-0.067</span></p></td><td class="cl-9b5cae36"><p class="cl-9b5c95d6"><span class="cl-9b59de40">0.935</span></p></td><td class="cl-9b5cae36"><p class="cl-9b5c95d6"><span class="cl-9b59de40">0.029</span></p></td><td class="cl-9b5cae36"><p class="cl-9b5c95d6"><span class="cl-9b59de40">1.030</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-9b5cae36"><p class="cl-9b5c95d6"><span class="cl-9b59de40">40</span></p></td><td class="cl-9b5cae36"><p class="cl-9b5c95d6"><span class="cl-9b59de40">-0.118</span></p></td><td class="cl-9b5cae36"><p class="cl-9b5c95d6"><span class="cl-9b59de40">0.888</span></p></td><td class="cl-9b5cae36"><p class="cl-9b5c95d6"><span class="cl-9b59de40">0.442</span></p></td><td class="cl-9b5cae36"><p class="cl-9b5c95d6"><span class="cl-9b59de40">1.556</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-9b5cae37"><p class="cl-9b5c95d6"><span class="cl-9b59de40">50</span></p></td><td class="cl-9b5cae37"><p class="cl-9b5c95d6"><span class="cl-9b59de40">-0.169</span></p></td><td class="cl-9b5cae37"><p class="cl-9b5c95d6"><span class="cl-9b59de40">0.844</span></p></td><td class="cl-9b5cae37"><p class="cl-9b5c95d6"><span class="cl-9b59de40">0.855</span></p></td><td class="cl-9b5cae37"><p class="cl-9b5c95d6"><span class="cl-9b59de40">2.350</span></p></td></tr></tbody></table></div>
<p>交互作用モデルでは、全ての独立変数についてモデルの<strong>シェーンフィールド残差</strong>と時間の相関がなくなっていることが分かる。</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="Chapter4.html#cb76-1" tabindex="-1"></a><span class="fu">cox.zph</span>(mod_cox_int)</span></code></pre></div>
<pre><code>##            chisq df    p
## fin       0.0290  1 0.86
## age       2.4002  1 0.12
## race      1.5400  1 0.21
## wexp      2.6158  1 0.11
## mar       0.6847  1 0.41
## paro      0.1608  1 0.69
## prio      0.0111  1 0.92
## work      0.2701  1 0.60
## age:stop  0.4199  1 0.52
## wexp:stop 1.5229  1 0.22
## GLOBAL    6.6780 10 0.76</code></pre>
<p>交互作用モデルの欠点は、<strong>交互作用項をパラメトリックな特定の形で定式化する必要がある</strong>点である。ただし、これまで時間と独立変数は一次の線形関係にあるとしていたが、代わりに時間の二乗や対数変換した時間をモデルに含めることも可能である。</p>
</div>
<div id="層化stratification" class="section level4 hasAnchor" number="4.3.2.2">
<h4><span class="header-section-number">4.3.2.2</span> 層化(stratification)<a href="Chapter4.html#層化stratification" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>もう一つの方法が<strong>層化</strong>という方法で、就業経験のような離散的な変数が比例ハザード性を満たさないときに使える。</p>
<p>例えば就業経験について層化を行うとすると、就業経験のある元服役囚のデータのみを含むモデルと、就業経験のない元服役囚のデータのみを含むモデルの2つを考える。いずれも同じ偏回帰係数を持つが、時間の関数の形が異なる。時間tにおける就業経験の効果は<span class="math inline">\(a_1(t) - a_2(t)\)</span>であり、いかなる制約も比例ハザード性も仮定していない。しかし、部分尤度法を用いる以上これを推定することはできない。</p>
<p><span class="math display">\[
\begin{aligned}
就業経験あり: log(h(t)) &amp;= a_1(t) + b_1x_1 + b_2x_2 + ...\\
就業経験なし: log(h(t)) &amp;= a_2(t) + b_1x_1 + b_2x_2 + ...
\end{aligned}
\]</span></p>
<p>層化モデルは、Rで以下のように実行できる。</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="Chapter4.html#cb78-1" tabindex="-1"></a>mod_cox_str <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(start, stop, arrest) <span class="sc">~</span> fin <span class="sc">+</span> age <span class="sc">+</span> race <span class="sc">+</span> mar </span>
<span id="cb78-2"><a href="Chapter4.html#cb78-2" tabindex="-1"></a>                 <span class="sc">+</span> paro <span class="sc">+</span> prio <span class="sc">+</span> work <span class="sc">+</span> <span class="fu">strata</span>(wexp), <span class="at">data =</span> recid_long)</span></code></pre></div>
<p>結果は以下の通り。層化したことで、就業経験の偏回帰係数がなくなる。このように、層化するとその独立変数の効果は推定できなくなる。</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="Chapter4.html#cb79-1" tabindex="-1"></a>mod_cox_str  </span></code></pre></div>
<pre><code>## Call:
## coxph(formula = Surv(start, stop, arrest) ~ fin + age + race + 
##     mar + paro + prio + work + strata(wexp), data = recid_long)
## 
##          coef exp(coef) se(coef)      z       p
## fin  -0.35910   0.69831  0.19121 -1.878 0.06038
## age  -0.04766   0.95346  0.02192 -2.174 0.02969
## race  0.34453   1.41133  0.30963  1.113 0.26583
## mar  -0.30368   0.73810  0.38355 -0.792 0.42850
## paro -0.06255   0.93937  0.19477 -0.321 0.74811
## prio  0.08419   1.08784  0.02905  2.898 0.00375
## work -1.32825   0.26494  0.25091 -5.294 1.2e-07
## 
## Likelihood ratio test=59.08  on 7 df, p=2.307e-10
## n= 19809, number of events= 114</code></pre>
<p>交互作用モデルと層化モデルの偏回帰係数を比較したのが表<a href="Chapter4.html#tab:tab-coxmodelcomp2">4.3</a>である。推定結果に少し違いがみられる。</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="Chapter4.html#cb81-1" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">Covariate =</span> <span class="fu">rownames</span>(mod_cox_int<span class="sc">$</span>coefficients <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>()),</span>
<span id="cb81-2"><a href="Chapter4.html#cb81-2" tabindex="-1"></a>       <span class="st">&quot;Coef(int)&quot;</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">sprintf</span>(<span class="st">&quot;%.3f&quot;</span>,<span class="fu">coef</span>(mod_cox_int))[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]),</span>
<span id="cb81-3"><a href="Chapter4.html#cb81-3" tabindex="-1"></a>       <span class="st">&quot;Exp(Coef_int)&quot;</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">sprintf</span>(<span class="st">&quot;%.3f&quot;</span>,<span class="fu">exp</span>(<span class="fu">coef</span>(mod_cox_int)))[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]),</span>
<span id="cb81-4"><a href="Chapter4.html#cb81-4" tabindex="-1"></a>       <span class="st">&quot;Coef(str)&quot;</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">sprintf</span>(<span class="st">&quot;%.3f&quot;</span>,<span class="fu">coef</span>(mod_cox_str))[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>], <span class="st">&quot;-&quot;</span>,<span class="fu">sprintf</span>(<span class="st">&quot;%.3f&quot;</span>,<span class="fu">coef</span>(mod_cox_str))[<span class="dv">4</span><span class="sc">:</span><span class="dv">7</span>],<span class="cn">NA</span>,<span class="cn">NA</span>),</span>
<span id="cb81-5"><a href="Chapter4.html#cb81-5" tabindex="-1"></a>       <span class="st">&quot;Exp(Coef_str)&quot;</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">sprintf</span>(<span class="st">&quot;%.3f&quot;</span>,<span class="fu">exp</span>(<span class="fu">coef</span>(mod_cox_str)))[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>], <span class="st">&quot;-&quot;</span>, <span class="fu">sprintf</span>(<span class="st">&quot;%.3f&quot;</span>,<span class="fu">exp</span>(<span class="fu">coef</span>(mod_cox_str)))[<span class="dv">4</span><span class="sc">:</span><span class="dv">7</span>],<span class="cn">NA</span>,<span class="cn">NA</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb81-6"><a href="Chapter4.html#cb81-6" tabindex="-1"></a>  <span class="fu">flextable</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb81-7"><a href="Chapter4.html#cb81-7" tabindex="-1"></a>  <span class="fu">add_header_row</span>(<span class="at">colwidth =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>),</span>
<span id="cb81-8"><a href="Chapter4.html#cb81-8" tabindex="-1"></a>                 <span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;&quot;</span>,<span class="st">&quot;時間との交互作用モデル&quot;</span>,<span class="st">&quot;層化モデル&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb81-9"><a href="Chapter4.html#cb81-9" tabindex="-1"></a>  flextable<span class="sc">::</span><span class="fu">align</span>(<span class="at">align =</span> <span class="st">&quot;center&quot;</span>, <span class="at">part =</span> <span class="st">&quot;all&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb81-10"><a href="Chapter4.html#cb81-10" tabindex="-1"></a>  <span class="fu">set_caption</span>(<span class="st">&quot;各モデルの推定値の比較&quot;</span>)</span></code></pre></div>
<div class="tabwid"><style>.cl-889ff0d2{}.cl-88993e9a{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-889c17b4{margin:0;text-align:center;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-889c2d80{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-889c2d81{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-889c2d8a{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-889ff0d2'>

<caption style="display:table-caption;margin:0pt;text-align:center;border-bottom: 0.00pt solid transparent;border-top: 0.00pt solid transparent;border-left: 0.00pt solid transparent;border-right: 0.00pt solid transparent;padding-top:3pt;padding-bottom:3pt;padding-left:3pt;padding-right:3pt;line-height: 1;background-color:transparent;">
<span id="tab:tab-coxmodelcomp2">表4.3: </span><span>各モデルの推定値の比較</span>
</caption>

<thead><tr style="overflow-wrap:break-word;"><th class="cl-889c2d80"><p class="cl-889c17b4"><span class="cl-88993e9a"></span></p></th><th  colspan="2"class="cl-889c2d80"><p class="cl-889c17b4"><span class="cl-88993e9a">時間との交互作用モデル</span></p></th><th  colspan="2"class="cl-889c2d80"><p class="cl-889c17b4"><span class="cl-88993e9a">層化モデル</span></p></th></tr><tr style="overflow-wrap:break-word;"><th class="cl-889c2d80"><p class="cl-889c17b4"><span class="cl-88993e9a">Covariate</span></p></th><th class="cl-889c2d80"><p class="cl-889c17b4"><span class="cl-88993e9a">Coef(int)</span></p></th><th class="cl-889c2d80"><p class="cl-889c17b4"><span class="cl-88993e9a">Exp(Coef_int)</span></p></th><th class="cl-889c2d80"><p class="cl-889c17b4"><span class="cl-88993e9a">Coef(str)</span></p></th><th class="cl-889c2d80"><p class="cl-889c17b4"><span class="cl-88993e9a">Exp(Coef_str)</span></p></th></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-889c2d81"><p class="cl-889c17b4"><span class="cl-88993e9a">fin</span></p></td><td class="cl-889c2d81"><p class="cl-889c17b4"><span class="cl-88993e9a">-0.362</span></p></td><td class="cl-889c2d81"><p class="cl-889c17b4"><span class="cl-88993e9a">0.696</span></p></td><td class="cl-889c2d81"><p class="cl-889c17b4"><span class="cl-88993e9a">-0.359</span></p></td><td class="cl-889c2d81"><p class="cl-889c17b4"><span class="cl-88993e9a">0.698</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-889c2d81"><p class="cl-889c17b4"><span class="cl-88993e9a">age</span></p></td><td class="cl-889c2d81"><p class="cl-889c17b4"><span class="cl-88993e9a">0.085</span></p></td><td class="cl-889c2d81"><p class="cl-889c17b4"><span class="cl-88993e9a">1.089</span></p></td><td class="cl-889c2d81"><p class="cl-889c17b4"><span class="cl-88993e9a">-0.048</span></p></td><td class="cl-889c2d81"><p class="cl-889c17b4"><span class="cl-88993e9a">0.953</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-889c2d81"><p class="cl-889c17b4"><span class="cl-88993e9a">race</span></p></td><td class="cl-889c2d81"><p class="cl-889c17b4"><span class="cl-88993e9a">0.306</span></p></td><td class="cl-889c2d81"><p class="cl-889c17b4"><span class="cl-88993e9a">1.357</span></p></td><td class="cl-889c2d81"><p class="cl-889c17b4"><span class="cl-88993e9a">0.345</span></p></td><td class="cl-889c2d81"><p class="cl-889c17b4"><span class="cl-88993e9a">1.411</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-889c2d81"><p class="cl-889c17b4"><span class="cl-88993e9a">wexp</span></p></td><td class="cl-889c2d81"><p class="cl-889c17b4"><span class="cl-88993e9a">-1.209</span></p></td><td class="cl-889c2d81"><p class="cl-889c17b4"><span class="cl-88993e9a">0.298</span></p></td><td class="cl-889c2d81"><p class="cl-889c17b4"><span class="cl-88993e9a">-</span></p></td><td class="cl-889c2d81"><p class="cl-889c17b4"><span class="cl-88993e9a">-</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-889c2d81"><p class="cl-889c17b4"><span class="cl-88993e9a">mar</span></p></td><td class="cl-889c2d81"><p class="cl-889c17b4"><span class="cl-88993e9a">-0.234</span></p></td><td class="cl-889c2d81"><p class="cl-889c17b4"><span class="cl-88993e9a">0.791</span></p></td><td class="cl-889c2d81"><p class="cl-889c17b4"><span class="cl-88993e9a">-0.304</span></p></td><td class="cl-889c2d81"><p class="cl-889c17b4"><span class="cl-88993e9a">0.738</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-889c2d81"><p class="cl-889c17b4"><span class="cl-88993e9a">paro</span></p></td><td class="cl-889c2d81"><p class="cl-889c17b4"><span class="cl-88993e9a">-0.063</span></p></td><td class="cl-889c2d81"><p class="cl-889c17b4"><span class="cl-88993e9a">0.939</span></p></td><td class="cl-889c2d81"><p class="cl-889c17b4"><span class="cl-88993e9a">-0.063</span></p></td><td class="cl-889c2d81"><p class="cl-889c17b4"><span class="cl-88993e9a">0.939</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-889c2d81"><p class="cl-889c17b4"><span class="cl-88993e9a">prio</span></p></td><td class="cl-889c2d81"><p class="cl-889c17b4"><span class="cl-88993e9a">0.081</span></p></td><td class="cl-889c2d81"><p class="cl-889c17b4"><span class="cl-88993e9a">1.084</span></p></td><td class="cl-889c2d81"><p class="cl-889c17b4"><span class="cl-88993e9a">0.084</span></p></td><td class="cl-889c2d81"><p class="cl-889c17b4"><span class="cl-88993e9a">1.088</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-889c2d81"><p class="cl-889c17b4"><span class="cl-88993e9a">work</span></p></td><td class="cl-889c2d81"><p class="cl-889c17b4"><span class="cl-88993e9a">-1.318</span></p></td><td class="cl-889c2d81"><p class="cl-889c17b4"><span class="cl-88993e9a">0.268</span></p></td><td class="cl-889c2d81"><p class="cl-889c17b4"><span class="cl-88993e9a">-1.328</span></p></td><td class="cl-889c2d81"><p class="cl-889c17b4"><span class="cl-88993e9a">0.265</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-889c2d81"><p class="cl-889c17b4"><span class="cl-88993e9a">age:stop</span></p></td><td class="cl-889c2d81"><p class="cl-889c17b4"><span class="cl-88993e9a">-0.005</span></p></td><td class="cl-889c2d81"><p class="cl-889c17b4"><span class="cl-88993e9a">0.995</span></p></td><td class="cl-889c2d81"><p class="cl-889c17b4"><span class="cl-88993e9a"></span></p></td><td class="cl-889c2d81"><p class="cl-889c17b4"><span class="cl-88993e9a"></span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-889c2d8a"><p class="cl-889c17b4"><span class="cl-88993e9a">wexp:stop</span></p></td><td class="cl-889c2d8a"><p class="cl-889c17b4"><span class="cl-88993e9a">0.041</span></p></td><td class="cl-889c2d8a"><p class="cl-889c17b4"><span class="cl-88993e9a">1.042</span></p></td><td class="cl-889c2d8a"><p class="cl-889c17b4"><span class="cl-88993e9a"></span></p></td><td class="cl-889c2d8a"><p class="cl-889c17b4"><span class="cl-88993e9a"></span></p></td></tr></tbody></table></div>
</div>
</div>
</div>
<div id="観測期間の選択" class="section level2 hasAnchor" number="4.4">
<h2><span class="header-section-number">4.4</span> 観測期間の選択<a href="Chapter4.html#観測期間の選択" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>今回の例では出所した日を観測の起点とするので比較的明確であるが、なかには観測時間の起点がそれほど明確でないデータもある。例えば、今回の再犯データでも個人の年齢や暦上の時間を観測時間の単位とすることも可能である。いずれにしても部分尤度法による推定は行えるが、重要な点はその観測時間の単位が妥当かを考えることである。例えばハザード率が強く年齢に依存しており、そのほかの時間単位にあまり依存していないと考えられるのであれば、年齢を観測時間の単位にすることは適切である。</p>
<p>理論的にはハザード率が二つ以上の時間に依存するモデルを定式化することはできるが、一般に大きなサンプルサイズや特殊な条件が必要である。このような方法が困難な場合は、異なる時間の単位を明示的に独立変数に含めるのが妥当である。今回も年齢(<code>age</code>)を独立変数に含めた。</p>
</div>
<div id="コックスモデルによる予測" class="section level2 hasAnchor" number="4.5">
<h2><span class="header-section-number">4.5</span> コックス・モデルによる予測<a href="Chapter4.html#コックスモデルによる予測" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>第<a href="Chapter3.html#c3">3</a>章で見たように、予測という観点で見るとパラメトリックなモデルが最も優れており、予測が非常に簡単である。一方で、コックス回帰モデルでも限定的であるが予測を行うことはできる。</p>
<p>コックス回帰を用いて主に予測できるのは生存関数(= 時間の経過とともに事象が生じていない確率がどのように変化するかを表す関数)であり、実際に観察された時間の範囲について行える。詳しい推定方法は <span class="citation">杉本 (<a href="#ref-Sugimoto2021">2021</a>)</span> などにあるが、モデル式の<span class="math inline">\(a(t)\)</span>の部分(通常はそれを対数変換した基準ハザード関数)をノンパラメトリックな方法を用いて推定することが多いようだ。Rで基準ハザード関数がどのように推定されているかについては、<a href="https://missingdatasolutions.rbind.io/2022/12/cox-baseline-hazard/">こちらのサイト</a>を参照。</p>
<p>生存関数には独立変数の値を指定することができ、これは実際に観測された値でなくても問題ない。例えば、1つ目のモデル(<code>mod_cox</code>)で、経済的支援を受けており、出所時の年齢21歳、黒人で未婚、仮釈放として出所し、就業経験があり、過去に有罪判決を4回受けている人について予測される生存確率は以下のようになる。</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="Chapter4.html#cb82-1" tabindex="-1"></a><span class="fu">survfit</span>(mod_cox, </span>
<span id="cb82-2"><a href="Chapter4.html#cb82-2" tabindex="-1"></a>        <span class="at">newdata =</span> <span class="fu">tibble</span>(<span class="at">fin =</span> <span class="dv">1</span>, <span class="at">age =</span> <span class="dv">21</span>, <span class="at">race =</span> <span class="dv">1</span>, <span class="at">wexp =</span> <span class="dv">1</span>, <span class="at">mar =</span> <span class="dv">0</span>, <span class="at">paro =</span> <span class="dv">1</span>, <span class="at">prio =</span> <span class="dv">4</span>),</span>
<span id="cb82-3"><a href="Chapter4.html#cb82-3" tabindex="-1"></a>        <span class="do">## 信頼区間の範囲</span></span>
<span id="cb82-4"><a href="Chapter4.html#cb82-4" tabindex="-1"></a>        <span class="at">conf.int =</span> <span class="fl">0.95</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb82-5"><a href="Chapter4.html#cb82-5" tabindex="-1"></a>  <span class="fu">summary</span>(<span class="at">times =</span> <span class="fu">c</span>(<span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">50</span>,<span class="dv">5</span>),<span class="dv">52</span>)) </span></code></pre></div>
<pre><code>## Call: survfit(formula = mod_cox, newdata = tibble(fin = 1, age = 21, 
##     race = 1, wexp = 1, mar = 0, paro = 1, prio = 4), conf.int = 0.95)
## 
##  time n.risk n.event survival std.err lower 95% CI upper 95% CI
##     0    432       0    1.000  0.0000        1.000        1.000
##     5    428       5    0.989  0.0053        0.979        1.000
##    10    418      10    0.967  0.0105        0.947        0.988
##    15    409      10    0.945  0.0151        0.916        0.975
##    20    397      15    0.911  0.0216        0.869        0.954
##    25    384      11    0.886  0.0262        0.836        0.939
##    30    374       9    0.865  0.0298        0.809        0.925
##    35    365      11    0.839  0.0341        0.775        0.909
##    40    351      14    0.806  0.0394        0.732        0.887
##    45    339      10    0.782  0.0430        0.702        0.871
##    50    325      15    0.746  0.0482        0.658        0.847
##    52    322       4    0.737  0.0495        0.646        0.840</code></pre>
<p>作図には<code>surveminer</code><a href="http://rpkgs.datanovia.com/survminer/reference/ggsurvplot.html">パッケージ</a>の<code>ggsurvplot()</code>関数と<code>ggsurvfit</code><a href="http://www.danieldsjoberg.com/ggsurvfit/index.html">パッケージ</a>の<code>ggsurvfit()</code>関数が有用である。結果をggplotオブジェクトとして出力してくれるので、グラフの修飾が容易である。作り方の詳細はパッケージのウェブページを参考にされたし。上記と同じ条件で予測した生存関数を図示したものが図<a href="Chapter4.html#fig:fig-survfit">4.5</a>である。なお、塗りつぶし部分は95%信頼区間である。</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="Chapter4.html#cb84-1" tabindex="-1"></a>predict_cox <span class="ot">&lt;-</span> <span class="fu">survfit</span>(mod_cox, </span>
<span id="cb84-2"><a href="Chapter4.html#cb84-2" tabindex="-1"></a>        <span class="at">newdata =</span> <span class="fu">tibble</span>(<span class="at">fin =</span> <span class="dv">1</span>, <span class="at">age =</span> <span class="dv">21</span>, <span class="at">race =</span> <span class="dv">1</span>, <span class="at">wexp =</span> <span class="dv">1</span>, <span class="at">mar =</span> <span class="dv">0</span>, <span class="at">paro =</span> <span class="dv">1</span>, <span class="at">prio =</span> <span class="dv">4</span>),</span>
<span id="cb84-3"><a href="Chapter4.html#cb84-3" tabindex="-1"></a>        <span class="do">## 信頼区間の範囲</span></span>
<span id="cb84-4"><a href="Chapter4.html#cb84-4" tabindex="-1"></a>        <span class="at">conf.int =</span> <span class="fl">0.95</span>)</span>
<span id="cb84-5"><a href="Chapter4.html#cb84-5" tabindex="-1"></a></span>
<span id="cb84-6"><a href="Chapter4.html#cb84-6" tabindex="-1"></a><span class="do">## ggsurvplot</span></span>
<span id="cb84-7"><a href="Chapter4.html#cb84-7" tabindex="-1"></a><span class="fu">ggsurvplot</span>(predict_cox,</span>
<span id="cb84-8"><a href="Chapter4.html#cb84-8" tabindex="-1"></a>           <span class="at">data =</span> <span class="fu">tibble</span>(<span class="at">fin =</span> <span class="dv">1</span>, <span class="at">age =</span> <span class="dv">21</span>, <span class="at">race =</span> <span class="dv">1</span>, <span class="at">wexp =</span> <span class="dv">1</span>, <span class="at">mar =</span> <span class="dv">0</span>, <span class="at">paro =</span> <span class="dv">1</span>, <span class="at">prio =</span> <span class="dv">4</span>),</span>
<span id="cb84-9"><a href="Chapter4.html#cb84-9" tabindex="-1"></a>           <span class="do">## 色</span></span>
<span id="cb84-10"><a href="Chapter4.html#cb84-10" tabindex="-1"></a>           <span class="at">palette =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb84-11"><a href="Chapter4.html#cb84-11" tabindex="-1"></a>           <span class="do">## 塗りつぶしの濃さ</span></span>
<span id="cb84-12"><a href="Chapter4.html#cb84-12" tabindex="-1"></a>           <span class="at">conf.int.alpha =</span> <span class="fl">0.15</span>,</span>
<span id="cb84-13"><a href="Chapter4.html#cb84-13" tabindex="-1"></a>           <span class="at">size =</span> <span class="fl">0.5</span>,</span>
<span id="cb84-14"><a href="Chapter4.html#cb84-14" tabindex="-1"></a>           <span class="do">## TRUEなら打ち切りデータの場所が明示される</span></span>
<span id="cb84-15"><a href="Chapter4.html#cb84-15" tabindex="-1"></a>           <span class="at">censor =</span> <span class="cn">FALSE</span>, </span>
<span id="cb84-16"><a href="Chapter4.html#cb84-16" tabindex="-1"></a>           <span class="at">ggtheme =</span> <span class="fu">theme_bw</span>()) <span class="ot">-&gt;</span> p1</span>
<span id="cb84-17"><a href="Chapter4.html#cb84-17" tabindex="-1"></a></span>
<span id="cb84-18"><a href="Chapter4.html#cb84-18" tabindex="-1"></a>p1<span class="sc">$</span>plot <span class="sc">+</span> </span>
<span id="cb84-19"><a href="Chapter4.html#cb84-19" tabindex="-1"></a> <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;week&quot;</span>, <span class="at">y =</span> <span class="st">&quot;survival probability&quot;</span>)<span class="sc">+</span></span>
<span id="cb84-20"><a href="Chapter4.html#cb84-20" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;ggsurvplot()&quot;</span>)<span class="sc">+</span></span>
<span id="cb84-21"><a href="Chapter4.html#cb84-21" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">16</span>)<span class="sc">+</span></span>
<span id="cb84-22"><a href="Chapter4.html#cb84-22" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)<span class="sc">+</span></span>
<span id="cb84-23"><a href="Chapter4.html#cb84-23" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">0.64556</span>,<span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb84-24"><a href="Chapter4.html#cb84-24" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="fl">0.65</span>,<span class="dv">1</span>,<span class="fl">0.05</span>)) <span class="ot">-&gt;</span> p1</span>
<span id="cb84-25"><a href="Chapter4.html#cb84-25" tabindex="-1"></a></span>
<span id="cb84-26"><a href="Chapter4.html#cb84-26" tabindex="-1"></a><span class="do">## ggsurvfit</span></span>
<span id="cb84-27"><a href="Chapter4.html#cb84-27" tabindex="-1"></a><span class="fu">ggsurvfit</span>(predict_cox)<span class="sc">+</span></span>
<span id="cb84-28"><a href="Chapter4.html#cb84-28" tabindex="-1"></a>  <span class="fu">add_confidence_interval</span>()<span class="sc">+</span></span>
<span id="cb84-29"><a href="Chapter4.html#cb84-29" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;week&quot;</span>, <span class="at">y =</span> <span class="st">&quot;survival probability&quot;</span>)<span class="sc">+</span></span>
<span id="cb84-30"><a href="Chapter4.html#cb84-30" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;ggsurfit()&quot;</span>)<span class="sc">+</span></span>
<span id="cb84-31"><a href="Chapter4.html#cb84-31" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">16</span>)<span class="sc">+</span></span>
<span id="cb84-32"><a href="Chapter4.html#cb84-32" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="fl">0.05</span>))　<span class="ot">-&gt;</span> p2</span>
<span id="cb84-33"><a href="Chapter4.html#cb84-33" tabindex="-1"></a></span>
<span id="cb84-34"><a href="Chapter4.html#cb84-34" tabindex="-1"></a>p1 <span class="sc">+</span> p2</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-survfit"></span>
<img src="SurvivalAnalysis_Using_R_files/figure-html/fig-survfit-1.png" alt="モデルから推定された生存曲線" width="864" />
<p class="caption">
図4.5: モデルから推定された生存曲線
</p>
</div>
<p>なお、何も指定しない場合、<code>survfit()</code>関数は連続変数は平均値で、二値変数は0で中心化した値を当てはめて予測を行う(図<a href="Chapter4.html#fig:fig-survfit2">4.6</a>)。</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="Chapter4.html#cb85-1" tabindex="-1"></a>mod_cox<span class="sc">$</span>means</span></code></pre></div>
<pre><code>##       fin       age      race      wexp       mar      paro      prio 
##  0.000000 24.597222  0.000000  0.000000  0.000000  0.000000  2.983796</code></pre>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="Chapter4.html#cb87-1" tabindex="-1"></a>predict_cox2 <span class="ot">&lt;-</span> <span class="fu">survfit</span>(mod_cox, </span>
<span id="cb87-2"><a href="Chapter4.html#cb87-2" tabindex="-1"></a>        <span class="do">## 信頼区間の範囲</span></span>
<span id="cb87-3"><a href="Chapter4.html#cb87-3" tabindex="-1"></a>        <span class="at">conf.int =</span> <span class="fl">0.95</span>)</span>
<span id="cb87-4"><a href="Chapter4.html#cb87-4" tabindex="-1"></a></span>
<span id="cb87-5"><a href="Chapter4.html#cb87-5" tabindex="-1"></a><span class="do">## ggsurvplot</span></span>
<span id="cb87-6"><a href="Chapter4.html#cb87-6" tabindex="-1"></a><span class="fu">ggsurvplot</span>(predict_cox2,</span>
<span id="cb87-7"><a href="Chapter4.html#cb87-7" tabindex="-1"></a>           <span class="at">data =</span> recid,</span>
<span id="cb87-8"><a href="Chapter4.html#cb87-8" tabindex="-1"></a>           <span class="do">## 色</span></span>
<span id="cb87-9"><a href="Chapter4.html#cb87-9" tabindex="-1"></a>           <span class="at">palette =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb87-10"><a href="Chapter4.html#cb87-10" tabindex="-1"></a>           <span class="do">## 塗りつぶしの濃さ</span></span>
<span id="cb87-11"><a href="Chapter4.html#cb87-11" tabindex="-1"></a>           <span class="at">conf.int.alpha =</span> <span class="fl">0.15</span>,</span>
<span id="cb87-12"><a href="Chapter4.html#cb87-12" tabindex="-1"></a>           <span class="at">size =</span> <span class="fl">0.5</span>,</span>
<span id="cb87-13"><a href="Chapter4.html#cb87-13" tabindex="-1"></a>           <span class="do">## TRUEなら打ち切りデータの場所が明示される</span></span>
<span id="cb87-14"><a href="Chapter4.html#cb87-14" tabindex="-1"></a>           <span class="at">censor =</span> <span class="cn">FALSE</span>, </span>
<span id="cb87-15"><a href="Chapter4.html#cb87-15" tabindex="-1"></a>           <span class="at">ggtheme =</span> <span class="fu">theme_bw</span>()) <span class="ot">-&gt;</span> p3</span>
<span id="cb87-16"><a href="Chapter4.html#cb87-16" tabindex="-1"></a></span>
<span id="cb87-17"><a href="Chapter4.html#cb87-17" tabindex="-1"></a>p3<span class="sc">$</span>plot <span class="sc">+</span> </span>
<span id="cb87-18"><a href="Chapter4.html#cb87-18" tabindex="-1"></a> <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;week&quot;</span>, <span class="at">y =</span> <span class="st">&quot;survival probability&quot;</span>)<span class="sc">+</span></span>
<span id="cb87-19"><a href="Chapter4.html#cb87-19" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">16</span>)<span class="sc">+</span></span>
<span id="cb87-20"><a href="Chapter4.html#cb87-20" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)<span class="sc">+</span></span>
<span id="cb87-21"><a href="Chapter4.html#cb87-21" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">0.64556</span>,<span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb87-22"><a href="Chapter4.html#cb87-22" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="fl">0.65</span>,<span class="dv">1</span>,<span class="fl">0.05</span>)) </span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-survfit2"></span>
<img src="SurvivalAnalysis_Using_R_files/figure-html/fig-survfit2-1.png" alt="独立変数を指定しないときにモデルから推定された生存曲線" width="432" />
<p class="caption">
図4.6: 独立変数を指定しないときにモデルから推定された生存曲線
</p>
</div>
<p>複数の値を当てはめて生存関数を予測することもできる(図<a href="Chapter4.html#fig:fig-survfit3">4.7</a>)。ここでは、前科の数<code>prio</code>が0,5,10回のときの予測を行う。</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="Chapter4.html#cb88-1" tabindex="-1"></a>predict_cox3 <span class="ot">&lt;-</span> <span class="fu">survfit</span>(mod_cox, </span>
<span id="cb88-2"><a href="Chapter4.html#cb88-2" tabindex="-1"></a>                        <span class="at">newdata =</span> <span class="fu">tibble</span>(<span class="at">fin =</span> <span class="dv">1</span>, <span class="at">age =</span> <span class="dv">21</span>, <span class="at">race =</span> <span class="dv">1</span>, <span class="at">wexp =</span> <span class="dv">1</span>, <span class="at">mar =</span> <span class="dv">0</span>, <span class="at">paro =</span> <span class="dv">1</span>, <span class="at">prio =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">5</span>,<span class="dv">10</span>)),</span>
<span id="cb88-3"><a href="Chapter4.html#cb88-3" tabindex="-1"></a>                        <span class="do">## 信頼区間の範囲</span></span>
<span id="cb88-4"><a href="Chapter4.html#cb88-4" tabindex="-1"></a>                        <span class="at">conf.int =</span> <span class="fl">0.95</span>)</span>
<span id="cb88-5"><a href="Chapter4.html#cb88-5" tabindex="-1"></a></span>
<span id="cb88-6"><a href="Chapter4.html#cb88-6" tabindex="-1"></a><span class="do">## ggsurvplot</span></span>
<span id="cb88-7"><a href="Chapter4.html#cb88-7" tabindex="-1"></a><span class="fu">ggsurvplot</span>(predict_cox3,</span>
<span id="cb88-8"><a href="Chapter4.html#cb88-8" tabindex="-1"></a>           <span class="at">data =</span> <span class="fu">tibble</span>(<span class="at">fin =</span> <span class="dv">1</span>, <span class="at">age =</span> <span class="dv">21</span>, <span class="at">race =</span> <span class="dv">1</span>, <span class="at">wexp =</span> <span class="dv">1</span>, <span class="at">mar =</span> <span class="dv">0</span>, <span class="at">paro =</span> <span class="dv">1</span>, <span class="at">prio =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">5</span>,<span class="dv">10</span>)),</span>
<span id="cb88-9"><a href="Chapter4.html#cb88-9" tabindex="-1"></a>           <span class="do">## 塗りつぶしの濃さ</span></span>
<span id="cb88-10"><a href="Chapter4.html#cb88-10" tabindex="-1"></a>           <span class="at">conf.int.alpha =</span> <span class="fl">0.15</span>,</span>
<span id="cb88-11"><a href="Chapter4.html#cb88-11" tabindex="-1"></a>           <span class="at">size =</span> <span class="fl">0.5</span>,</span>
<span id="cb88-12"><a href="Chapter4.html#cb88-12" tabindex="-1"></a>           <span class="do">## TRUEなら打ち切りデータの場所が明示される</span></span>
<span id="cb88-13"><a href="Chapter4.html#cb88-13" tabindex="-1"></a>           <span class="at">censor =</span> <span class="cn">FALSE</span>, </span>
<span id="cb88-14"><a href="Chapter4.html#cb88-14" tabindex="-1"></a>           <span class="at">legend.title =</span> <span class="st">&quot;prio&quot;</span>,</span>
<span id="cb88-15"><a href="Chapter4.html#cb88-15" tabindex="-1"></a>           <span class="at">legend.labs =</span> <span class="fu">c</span>(<span class="st">&quot;0&quot;</span>,<span class="st">&quot;5&quot;</span>,<span class="st">&quot;10&quot;</span>),</span>
<span id="cb88-16"><a href="Chapter4.html#cb88-16" tabindex="-1"></a>           <span class="at">ggtheme =</span> <span class="fu">theme_bw</span>()) <span class="ot">-&gt;</span> p4</span>
<span id="cb88-17"><a href="Chapter4.html#cb88-17" tabindex="-1"></a></span>
<span id="cb88-18"><a href="Chapter4.html#cb88-18" tabindex="-1"></a>p4<span class="sc">$</span>plot <span class="sc">+</span> </span>
<span id="cb88-19"><a href="Chapter4.html#cb88-19" tabindex="-1"></a>  <span class="fu">scale_color_nejm</span>()<span class="sc">+</span></span>
<span id="cb88-20"><a href="Chapter4.html#cb88-20" tabindex="-1"></a>  <span class="fu">scale_fill_nejm</span>()<span class="sc">+</span></span>
<span id="cb88-21"><a href="Chapter4.html#cb88-21" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;week&quot;</span>, <span class="at">y =</span> <span class="st">&quot;survival probability&quot;</span>)<span class="sc">+</span></span>
<span id="cb88-22"><a href="Chapter4.html#cb88-22" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">16</span>)<span class="sc">+</span></span>
<span id="cb88-23"><a href="Chapter4.html#cb88-23" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span>)<span class="sc">+</span></span>
<span id="cb88-24"><a href="Chapter4.html#cb88-24" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">0.4</span>,<span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb88-25"><a href="Chapter4.html#cb88-25" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="fl">0.2</span>)) </span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-survfit3"></span>
<img src="SurvivalAnalysis_Using_R_files/figure-html/fig-survfit3-1.png" alt="独立変数を指定しないときにモデルから推定された生存曲線" width="432" />
<p class="caption">
図4.7: 独立変数を指定しないときにモデルから推定された生存曲線
</p>
</div>
<p>時間依存独立変数を持つ場合も同様に予測することができる(図<a href="Chapter4.html#fig:fig-survfit4">4.8</a>)。</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="Chapter4.html#cb89-1" tabindex="-1"></a>predict_cox_ti <span class="ot">&lt;-</span> <span class="fu">survfit</span>(mod_cox_ti,</span>
<span id="cb89-2"><a href="Chapter4.html#cb89-2" tabindex="-1"></a>                        <span class="at">newdata =</span> <span class="fu">tibble</span>(<span class="at">fin =</span> <span class="dv">1</span>, <span class="at">age =</span> <span class="dv">21</span>, <span class="at">race =</span> <span class="dv">1</span>, <span class="at">wexp =</span> <span class="dv">1</span>, <span class="at">mar =</span> <span class="dv">0</span>, <span class="at">paro =</span> <span class="dv">1</span>, <span class="at">prio =</span> <span class="dv">4</span>, <span class="at">work =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)),</span>
<span id="cb89-3"><a href="Chapter4.html#cb89-3" tabindex="-1"></a>                        <span class="do">## 信頼区間の範囲</span></span>
<span id="cb89-4"><a href="Chapter4.html#cb89-4" tabindex="-1"></a>                        <span class="at">conf.int =</span> <span class="fl">0.95</span>)</span>
<span id="cb89-5"><a href="Chapter4.html#cb89-5" tabindex="-1"></a></span>
<span id="cb89-6"><a href="Chapter4.html#cb89-6" tabindex="-1"></a><span class="do">## ggsurvplot</span></span>
<span id="cb89-7"><a href="Chapter4.html#cb89-7" tabindex="-1"></a><span class="fu">ggsurvplot</span>(predict_cox_ti,</span>
<span id="cb89-8"><a href="Chapter4.html#cb89-8" tabindex="-1"></a>           <span class="at">data =</span> <span class="fu">tibble</span>(<span class="at">fin =</span> <span class="dv">1</span>, <span class="at">age =</span> <span class="dv">21</span>, <span class="at">race =</span> <span class="dv">1</span>, <span class="at">wexp =</span> <span class="dv">1</span>, <span class="at">mar =</span> <span class="dv">0</span>, <span class="at">paro =</span> <span class="dv">1</span>, <span class="at">prio =</span> <span class="dv">4</span>, <span class="at">work =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)),</span>
<span id="cb89-9"><a href="Chapter4.html#cb89-9" tabindex="-1"></a>           <span class="do">## 塗りつぶしの濃さ</span></span>
<span id="cb89-10"><a href="Chapter4.html#cb89-10" tabindex="-1"></a>           <span class="at">conf.int.alpha =</span> <span class="fl">0.15</span>,</span>
<span id="cb89-11"><a href="Chapter4.html#cb89-11" tabindex="-1"></a>           <span class="at">size =</span> <span class="fl">0.5</span>,</span>
<span id="cb89-12"><a href="Chapter4.html#cb89-12" tabindex="-1"></a>           <span class="do">## TRUEなら打ち切りデータの場所が明示される</span></span>
<span id="cb89-13"><a href="Chapter4.html#cb89-13" tabindex="-1"></a>           <span class="at">censor =</span> <span class="cn">FALSE</span>, </span>
<span id="cb89-14"><a href="Chapter4.html#cb89-14" tabindex="-1"></a>           <span class="at">legend.title =</span> <span class="st">&quot;work&quot;</span>,</span>
<span id="cb89-15"><a href="Chapter4.html#cb89-15" tabindex="-1"></a>           <span class="at">legend.labs =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),</span>
<span id="cb89-16"><a href="Chapter4.html#cb89-16" tabindex="-1"></a>           <span class="at">ggtheme =</span> <span class="fu">theme_bw</span>()) <span class="ot">-&gt;</span> p5</span>
<span id="cb89-17"><a href="Chapter4.html#cb89-17" tabindex="-1"></a></span>
<span id="cb89-18"><a href="Chapter4.html#cb89-18" tabindex="-1"></a>p5<span class="sc">$</span>plot <span class="sc">+</span> </span>
<span id="cb89-19"><a href="Chapter4.html#cb89-19" tabindex="-1"></a>  <span class="fu">scale_color_nejm</span>()<span class="sc">+</span></span>
<span id="cb89-20"><a href="Chapter4.html#cb89-20" tabindex="-1"></a>  <span class="fu">scale_fill_nejm</span>()<span class="sc">+</span></span>
<span id="cb89-21"><a href="Chapter4.html#cb89-21" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;week&quot;</span>, <span class="at">y =</span> <span class="st">&quot;survival probability&quot;</span>)<span class="sc">+</span></span>
<span id="cb89-22"><a href="Chapter4.html#cb89-22" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">16</span>)<span class="sc">+</span></span>
<span id="cb89-23"><a href="Chapter4.html#cb89-23" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span>)<span class="sc">+</span></span>
<span id="cb89-24"><a href="Chapter4.html#cb89-24" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">0.5</span>,<span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb89-25"><a href="Chapter4.html#cb89-25" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="fl">0.05</span>)) </span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-survfit4"></span>
<img src="SurvivalAnalysis_Using_R_files/figure-html/fig-survfit4-1.png" alt="時間依存独立変数をもつモデルから推定された生存曲線" width="432" />
<p class="caption">
図4.8: 時間依存独立変数をもつモデルから推定された生存曲線
</p>
</div>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references csl-bib-body hanging-indent" line-spacing="2">
<div id="ref-Allison2014" class="csl-entry">
Allison, P. D. (2014). <em>Event history and survival analysis: Regression for longitudinal event data</em>. SAGE Publications.
</div>
<div id="ref-Cox1972" class="csl-entry">
Cox, D. R. (1972). Regression models and life-tables. <em>J. R. Stat. Soc.</em>, <em>34</em>(2), 187–202.
</div>
<div id="ref-Sugimoto2021" class="csl-entry">
杉本知之. (2021). <em>生存時間解析</em>. 朝倉書店.
</div>
<div id="ref-Kasuya2012" class="csl-entry">
粕谷英一. (2012). <em>一般化線形モデル</em>. 共立出版.
</div>
</div>
<div class="footnotes">
<hr />
<ol start="11">
<li id="fn11"><p>比例ハザードモデルは<span class="math inline">\(h(t) = h_0(t) + exp(b_1x_1 + b_2x_2)\)</span>のように表されることも多い。このとき、<span class="math inline">\(h_0(t)\)</span>は<strong>基準ハザード関数</strong>(baseline hazard function)と呼ばれ、式<a href="Chapter4.html#eq:eq-cox">(4.1)</a>からわかるように<span class="math inline">\(h_0(t) = exp(a(t))\)</span>である。<a href="Chapter4.html#fnref11" class="footnote-back">↩︎</a></p></li>
<li id="fn12"><p>交互作用の解釈については、 <span class="citation">粕谷 (<a href="#ref-Kasuya2012">2012</a>)</span> なども参照。<a href="Chapter4.html#fnref12" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="Chapter3.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="Chapter5.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
