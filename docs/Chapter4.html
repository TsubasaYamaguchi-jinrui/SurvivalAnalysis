<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4 コックス回帰モデル | Event History and Survival Analysis Using R</title>
  <meta name="description" content="4 コックス回帰モデル | Event History and Survival Analysis Using R" />
  <meta name="generator" content="bookdown 0.31 and GitBook 2.6.7" />

  <meta property="og:title" content="4 コックス回帰モデル | Event History and Survival Analysis Using R" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 コックス回帰モデル | Event History and Survival Analysis Using R" />
  
  
  

<meta name="author" content="Tsubasa Yamaguchi" />


<meta name="date" content="2023-05-31" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="Chapter3.html"/>
<link rel="next" href="sessioninfo.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="libs/pagedtable-1.1/js/pagedtable.js"></script>
<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.6.1/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.27/datatables.js"></script>
<link href="libs/dt-core-1.12.1/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.12.1/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.12.1/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<link href="libs/tabwid-1.1.3/tabwid.css" rel="stylesheet" />
<script src="libs/tabwid-1.1.3/tabwid.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="custom_style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>本稿の目的</a></li>
<li class="chapter" data-level="" data-path="Chapter0.html"><a href="Chapter0.html"><i class="fa fa-check"></i>0. パッケージの読み込み</a></li>
<li class="chapter" data-level="1" data-path="Chapter1.html"><a href="Chapter1.html"><i class="fa fa-check"></i><b>1</b> はじめに</a>
<ul>
<li class="chapter" data-level="1.1" data-path="Chapter1.html"><a href="Chapter1.html#s2-1"><i class="fa fa-check"></i><b>1.1</b> イベントヒストリー分析とは何か</a></li>
<li class="chapter" data-level="1.2" data-path="Chapter1.html"><a href="Chapter1.html#s2-2"><i class="fa fa-check"></i><b>1.2</b> イベント・ヒストリー分析の難しさ</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="Chapter1.html"><a href="Chapter1.html#打ち切り"><i class="fa fa-check"></i><b>1.2.1</b> 打ち切り</a></li>
<li class="chapter" data-level="1.2.2" data-path="Chapter1.html"><a href="Chapter1.html#時間依存共変量"><i class="fa fa-check"></i><b>1.2.2</b> 時間依存共変量</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="Chapter1.html"><a href="Chapter1.html#s2-3"><i class="fa fa-check"></i><b>1.3</b> イベント・ヒストリー分析の種類</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="Chapter1.html"><a href="Chapter1.html#繰り返しの有無"><i class="fa fa-check"></i><b>1.3.1</b> 繰り返しの有無</a></li>
<li class="chapter" data-level="1.3.2" data-path="Chapter1.html"><a href="Chapter1.html#単一の事象と複数の事象"><i class="fa fa-check"></i><b>1.3.2</b> 単一の事象と複数の事象</a></li>
<li class="chapter" data-level="1.3.3" data-path="Chapter1.html"><a href="Chapter1.html#パラメトリック法とノンパラメトリック法"><i class="fa fa-check"></i><b>1.3.3</b> パラメトリック法とノンパラメトリック法</a></li>
<li class="chapter" data-level="1.3.4" data-path="Chapter1.html"><a href="Chapter1.html#離散時間と連続時間"><i class="fa fa-check"></i><b>1.3.4</b> 離散時間と連続時間</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="Chapter2.html"><a href="Chapter2.html"><i class="fa fa-check"></i><b>2</b> 離散時間モデル</a>
<ul>
<li class="chapter" data-level="2.1" data-path="Chapter2.html"><a href="Chapter2.html#離散時間モデルの例"><i class="fa fa-check"></i><b>2.1</b> 離散時間モデルの例</a></li>
<li class="chapter" data-level="2.2" data-path="Chapter2.html"><a href="Chapter2.html#離散時間ハザード"><i class="fa fa-check"></i><b>2.2</b> 離散時間ハザード</a></li>
<li class="chapter" data-level="2.3" data-path="Chapter2.html"><a href="Chapter2.html#ロジスティック回帰モデル"><i class="fa fa-check"></i><b>2.3</b> ロジスティック回帰モデル</a></li>
<li class="chapter" data-level="2.4" data-path="Chapter2.html"><a href="Chapter2.html#モデルの推定"><i class="fa fa-check"></i><b>2.4</b> モデルの推定</a></li>
<li class="chapter" data-level="2.5" data-path="Chapter2.html"><a href="Chapter2.html#rでの実装"><i class="fa fa-check"></i><b>2.5</b> Rでの実装</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="Chapter2.html"><a href="Chapter2.html#データの加工"><i class="fa fa-check"></i><b>2.5.1</b> データの加工</a></li>
<li class="chapter" data-level="2.5.2" data-path="Chapter2.html"><a href="Chapter2.html#分析"><i class="fa fa-check"></i><b>2.5.2</b> 分析</a></li>
<li class="chapter" data-level="2.5.3" data-path="Chapter2.html"><a href="Chapter2.html#結果の解釈"><i class="fa fa-check"></i><b>2.5.3</b> 結果の解釈</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="Chapter2.html"><a href="Chapter2.html#尤度比検定"><i class="fa fa-check"></i><b>2.6</b> 尤度比検定</a></li>
<li class="chapter" data-level="2.7" data-path="Chapter2.html"><a href="Chapter2.html#離散時間ロジスティック回帰モデルの注意点"><i class="fa fa-check"></i><b>2.7</b> 離散時間ロジスティック回帰モデルの注意点</a></li>
<li class="chapter" data-level="2.8" data-path="Chapter2.html"><a href="Chapter2.html#打ち切りデータの扱い"><i class="fa fa-check"></i><b>2.8</b> 打ち切りデータの扱い</a></li>
<li class="chapter" data-level="2.9" data-path="Chapter2.html"><a href="Chapter2.html#離散時間モデルと連続時間モデル"><i class="fa fa-check"></i><b>2.9</b> 離散時間モデルと連続時間モデル</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="Chapter3.html"><a href="Chapter3.html"><i class="fa fa-check"></i><b>3</b> 連続時間を用いたパラメトリックな手法</a>
<ul>
<li class="chapter" data-level="3.1" data-path="Chapter3.html"><a href="Chapter3.html#連続時間ハザード率"><i class="fa fa-check"></i><b>3.1</b> 連続時間ハザード率</a></li>
<li class="chapter" data-level="3.2" data-path="Chapter3.html"><a href="Chapter3.html#パラメトリックな比例ハザードモデル"><i class="fa fa-check"></i><b>3.2</b> パラメトリックな比例ハザードモデル</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="Chapter3.html"><a href="Chapter3.html#モデルの分類"><i class="fa fa-check"></i><b>3.2.1</b> モデルの分類</a>
<ul>
<li class="chapter" data-level="3.2.1.1" data-path="Chapter3.html"><a href="Chapter3.html#指数回帰モデル"><i class="fa fa-check"></i><b>3.2.1.1</b> 指数回帰モデル</a></li>
<li class="chapter" data-level="3.2.1.2" data-path="Chapter3.html"><a href="Chapter3.html#ゴンぺルツ回帰モデル"><i class="fa fa-check"></i><b>3.2.1.2</b> ゴンぺルツ回帰モデル</a></li>
<li class="chapter" data-level="3.2.1.3" data-path="Chapter3.html"><a href="Chapter3.html#ワイブル回帰モデル"><i class="fa fa-check"></i><b>3.2.1.3</b> ワイブル回帰モデル</a></li>
</ul></li>
<li class="chapter" data-level="3.2.2" data-path="Chapter3.html"><a href="Chapter3.html#注意点"><i class="fa fa-check"></i><b>3.2.2</b> 注意点</a></li>
<li class="chapter" data-level="3.2.3" data-path="Chapter3.html"><a href="Chapter3.html#rでの実装-1"><i class="fa fa-check"></i><b>3.2.3</b> Rでの実装</a>
<ul>
<li class="chapter" data-level="3.2.3.1" data-path="Chapter3.html"><a href="Chapter3.html#データの読み込み"><i class="fa fa-check"></i><b>3.2.3.1</b> データの読み込み</a></li>
<li class="chapter" data-level="3.2.3.2" data-path="Chapter3.html"><a href="Chapter3.html#分析の実行"><i class="fa fa-check"></i><b>3.2.3.2</b> 分析の実行</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="Chapter3.html"><a href="Chapter3.html#加速時間ハザードモデル"><i class="fa fa-check"></i><b>3.3</b> 加速時間ハザードモデル</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="Chapter3.html"><a href="Chapter3.html#モデルの概要"><i class="fa fa-check"></i><b>3.3.1</b> モデルの概要</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="Chapter3.html"><a href="Chapter3.html#rでの実装-2"><i class="fa fa-check"></i><b>3.4</b> Rでの実装</a></li>
<li class="chapter" data-level="3.5" data-path="Chapter3.html"><a href="Chapter3.html#適合度の評価"><i class="fa fa-check"></i><b>3.5</b> 適合度の評価</a></li>
<li class="chapter" data-level="3.6" data-path="Chapter3.html"><a href="Chapter3.html#観察されない異質性の原因"><i class="fa fa-check"></i><b>3.6</b> 観察されない異質性の原因</a></li>
<li class="chapter" data-level="3.7" data-path="Chapter3.html"><a href="Chapter3.html#なぜパラメトリックモデルを用いるのか"><i class="fa fa-check"></i><b>3.7</b> なぜパラメトリックモデルを用いるのか</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="Chapter4.html"><a href="Chapter4.html"><i class="fa fa-check"></i><b>4</b> コックス回帰モデル</a>
<ul>
<li class="chapter" data-level="4.1" data-path="Chapter4.html"><a href="Chapter4.html#比例ハザードモデル"><i class="fa fa-check"></i><b>4.1</b> 比例ハザードモデル</a></li>
<li class="chapter" data-level="4.2" data-path="Chapter4.html"><a href="Chapter4.html#部分尤度法"><i class="fa fa-check"></i><b>4.2</b> 部分尤度法</a></li>
<li class="chapter" data-level="4.3" data-path="Chapter4.html"><a href="Chapter4.html#rによる実装"><i class="fa fa-check"></i><b>4.3</b> Rによる実装</a></li>
<li class="chapter" data-level="4.4" data-path="Chapter4.html"><a href="Chapter4.html#時間に依存する独立変数"><i class="fa fa-check"></i><b>4.4</b> 時間に依存する独立変数</a></li>
<li class="chapter" data-level="4.5" data-path="Chapter4.html"><a href="Chapter4.html#時間依存独立変数を含むモデル"><i class="fa fa-check"></i><b>4.5</b> 時間依存独立変数を含むモデル</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="Chapter4.html"><a href="Chapter4.html#プログラミングステートメント法programming-statements-method"><i class="fa fa-check"></i><b>4.5.1</b> プログラミング・ステートメント法(programming statements method)</a></li>
<li class="chapter" data-level="4.5.2" data-path="Chapter4.html"><a href="Chapter4.html#エピソード分割法episode-splitting-method"><i class="fa fa-check"></i><b>4.5.2</b> エピソード分割法(episode splitting method)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="sessioninfo.html"><a href="sessioninfo.html"><i class="fa fa-check"></i>実行環境</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Event History and Survival Analysis Using R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="c4" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">4</span> コックス回帰モデル<a href="Chapter4.html#c4" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>前章(<a href="Chapter3.html#c3">3</a>)で解説したパラメトリックモデルは非常に有効である一方で以下の2点の欠点もあった。</p>
<ol style="list-style-type: decimal">
<li>最も適切な分布を決めなくてはならず、それがしばしば難しい<br />
</li>
<li>時間依存的な独立変数を使うことができない</li>
</ol>
<p>コックスの比例ハザードモデル<span class="citation">(<a href="#ref-Cox1972" role="doc-biblioref">Cox, 1972</a>)</span> (<strong>コックス回帰モデル</strong>)はこうした欠点をどちらも解決してくれる優れた分析手法である。</p>
<div id="比例ハザードモデル" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> 比例ハザードモデル<a href="Chapter4.html#比例ハザードモデル" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>コックス回帰モデルはこれまで説明した<strong>パラメトリックな比例ハザードモデルを一般化したもの</strong>といえる。ひとまず、非時間依存な独立変数2つを持つモデルを考えると、比例ハザードモデルは以下のように書ける(式<a href="Chapter4.html#eq:eq-cox">(4.1)</a>)。ここで、<span class="math inline">\(a(t)\)</span>は時間の関数であり、どんな形でもよい。この形を一定の形に決める必要がないので、このモデルはしばしば「セミパラメトリック」なモデルと呼ばれる。</p>
<p><span class="math display" id="eq:eq-cox">\[
log(h(t)) = a(t) + b_1x_1 + b_2x_2 \tag{4.1}
\]</span></p>
<p>任意の時間<span class="math inline">\(t\)</span>に対して、個体<span class="math inline">\(i\)</span>と<span class="math inline">\(j\)</span>のハザード比(<span class="math inline">\(h_i(t)/h_j(t)\)</span>)の値が一定なので比例ハザードモデルといわれている。第<a href="Chapter3.html#c3">3</a>章のパラメトリックなモデルはコックス回帰モデルの特殊例である。<span class="math inline">\(a(t)\)</span>が定数なら指数分布モデル、<span class="math inline">\(a(t) = ct\)</span>ならワイブル回帰モデルになる。<span class="math inline">\(a(t)\)</span>はいかなる形も取れるので、例えば以下のような4次の多項式にすることもできる(式<a href="Chapter4.html#eq:eq-cox2">(4.2)</a>)。</p>
<p><span class="math display" id="eq:eq-cox2">\[
log(h(t)) = a_0 + a_1t + a_2t^2 + a_3t^3 + a_4t^4 \tag{4.2}
\]</span></p>
</div>
<div id="部分尤度法" class="section level2 hasAnchor" number="4.2">
<h2><span class="header-section-number">4.2</span> 部分尤度法<a href="Chapter4.html#部分尤度法" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>コックス回帰モデルでは<strong>部分尤度法</strong>と呼ばれる方法でパラメータの推定を行う。この方法では、尤度関数を偏回帰係数(<span class="math inline">\(b_1,b_2\)</span>)のみを含む部分と偏回帰係数と関数<span class="math inline">\(a(t)\)</span>の両方を含む部分に分解し、前者のみに着目して通常のパラメータ推定を行う。つまり、時間<span class="math inline">\(t\)</span>に依存する部分を無視して偏回帰係数のみを推定できるのである。部分尤度法では正確な事象の発生時間ではなく、事象の発生順序のみに基づいて推定が行われるため、時間を二乗したり整数倍しても推定結果は変わらない。</p>
</div>
<div id="rによる実装" class="section level2 hasAnchor" number="4.3">
<h2><span class="header-section-number">4.3</span> Rによる実装<a href="Chapter4.html#rによる実装" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>第<a href="Chapter3.html#c3">3</a>章で分析した元服役囚の再犯データにコックス回帰モデルを当てはめる。分析には、<code>survival</code>パッケージの<code>coxph()</code>関数を使用する。</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="Chapter4.html#cb50-1" aria-hidden="true" tabindex="-1"></a>mod_cox <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(week, arrest) <span class="sc">~</span> fin <span class="sc">+</span> age <span class="sc">+</span> race <span class="sc">+</span> wexp <span class="sc">+</span> mar </span>
<span id="cb50-2"><a href="Chapter4.html#cb50-2" aria-hidden="true" tabindex="-1"></a>                 <span class="sc">+</span> paro <span class="sc">+</span> prio, <span class="at">data =</span> recid)</span></code></pre></div>
<p>結果は以下の通り。係数の推定値自体はワイブル回帰モデルとほとんど変わらない(表<a href="Chapter3.html#tab:tab-modelcomparison2">3.3</a>参照)。指数変換された標準偏回帰係数はパラメトリックなモデルと同様にハザード比として解釈できる。例えば、経済的支援を受けた元服役囚は受けてない元服役囚よりも再犯の可能性が約32%低下することが分かる。</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="Chapter4.html#cb51-1" aria-hidden="true" tabindex="-1"></a>mod_cox</span></code></pre></div>
<pre><code>## Call:
## coxph(formula = Surv(week, arrest) ~ fin + age + race + wexp + 
##     mar + paro + prio, data = recid)
## 
##          coef exp(coef) se(coef)      z       p
## fin  -0.37942   0.68426  0.19138 -1.983 0.04742
## age  -0.05744   0.94418  0.02200 -2.611 0.00903
## race  0.31390   1.36875  0.30799  1.019 0.30812
## wexp -0.14980   0.86088  0.21222 -0.706 0.48029
## mar  -0.43370   0.64810  0.38187 -1.136 0.25606
## paro -0.08487   0.91863  0.19576 -0.434 0.66461
## prio  0.09150   1.09581  0.02865  3.194 0.00140
## 
## Likelihood ratio test=33.27  on 7 df, p=2.362e-05
## n= 432, number of events= 114</code></pre>
</div>
<div id="時間に依存する独立変数" class="section level2 hasAnchor" number="4.4">
<h2><span class="header-section-number">4.4</span> 時間に依存する独立変数<a href="Chapter4.html#時間に依存する独立変数" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>コックス回帰モデルは時間依存的な独立変数を含むモデルに拡張できる(式<a href="Chapter4.html#eq:eq-cox3">(4.3)</a>)。</p>
<p><span class="math display" id="eq:eq-cox3">\[
log(h(t)) = a(t) + b_1x_1 + b_2x_2(t)  \tag{4.3}
\]</span></p>
<p>独立変数の値の変化とそれがハザード率に与える影響の間にタイムラグがある場合は、例えば以下のように1週間前の値を独立変数にするようにモデリングすることもできる(式<a href="Chapter4.html#eq:eq-cox4">(4.4)</a>)。</p>
<p><span class="math display" id="eq:eq-cox4">\[
log(h(t)) = a(t) + b_1x_1 + b_2x_2(t-1)  \tag{4.4} 　　
\]</span></p>
<p>再犯データのモデルの独立変数に、各週の就業状況(<code>work</code>)を加えてモデリングを行う。Rで分析を行う際には、それぞれの人の各週のデータすべてが1行ずつあるようなデータフレームを作成する必要がある。</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="Chapter4.html#cb53-1" aria-hidden="true" tabindex="-1"></a>recid <span class="sc">%&gt;%</span> </span>
<span id="cb53-2"><a href="Chapter4.html#cb53-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;id&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb53-3"><a href="Chapter4.html#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="do">### 就業状態を一列に</span></span>
<span id="cb53-4"><a href="Chapter4.html#cb53-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> work1<span class="sc">:</span>work52,</span>
<span id="cb53-5"><a href="Chapter4.html#cb53-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;work_week&quot;</span>,</span>
<span id="cb53-6"><a href="Chapter4.html#cb53-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;work&quot;</span>,</span>
<span id="cb53-7"><a href="Chapter4.html#cb53-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_drop_na =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb53-8"><a href="Chapter4.html#cb53-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(id) <span class="sc">%&gt;%</span> </span>
<span id="cb53-9"><a href="Chapter4.html#cb53-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span></span>
<span id="cb53-10"><a href="Chapter4.html#cb53-10" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 各行データの観察開始時点</span></span>
<span id="cb53-11"><a href="Chapter4.html#cb53-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">start =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>() <span class="sc">-</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb53-12"><a href="Chapter4.html#cb53-12" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 各行データの観察終了時点(何週目か)  </span></span>
<span id="cb53-13"><a href="Chapter4.html#cb53-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">stop =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb53-14"><a href="Chapter4.html#cb53-14" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 再犯があった州のarrestのみを1にして、そのほかは0にする  </span></span>
<span id="cb53-15"><a href="Chapter4.html#cb53-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">arrest =</span> <span class="fu">ifelse</span>(arrest <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> week <span class="sc">==</span> stop,<span class="dv">1</span>,<span class="dv">0</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb53-16"><a href="Chapter4.html#cb53-16" aria-hidden="true" tabindex="-1"></a>  <span class="do">##1週前の就業状態  </span></span>
<span id="cb53-17"><a href="Chapter4.html#cb53-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">worklag =</span> <span class="fu">lag</span>(work,<span class="dv">1</span>))<span class="ot">-&gt;</span> recid_long</span></code></pre></div>
<p>それでは、時間依存変数を含んだコックス回帰モデルを実行する。まずは式<a href="Chapter4.html#eq:eq-cox3">(4.3)</a>のモデルを推定する。従属変数は、<code>Surv(start, stop,arrest)</code>となる点に注意。</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="Chapter4.html#cb54-1" aria-hidden="true" tabindex="-1"></a>mod_cox_ti <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(start, stop, arrest) <span class="sc">~</span> fin <span class="sc">+</span> age <span class="sc">+</span> race <span class="sc">+</span> wexp <span class="sc">+</span> mar </span>
<span id="cb54-2"><a href="Chapter4.html#cb54-2" aria-hidden="true" tabindex="-1"></a>                 <span class="sc">+</span> paro <span class="sc">+</span> prio <span class="sc">+</span> work, <span class="at">data =</span> recid_long)</span></code></pre></div>
<p>結果は以下の通り。</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="Chapter4.html#cb55-1" aria-hidden="true" tabindex="-1"></a>mod_cox_ti</span></code></pre></div>
<pre><code>## Call:
## coxph(formula = Surv(start, stop, arrest) ~ fin + age + race + 
##     wexp + mar + paro + prio + work, data = recid_long)
## 
##          coef exp(coef) se(coef)      z        p
## fin  -0.35672   0.69997  0.19113 -1.866  0.06198
## age  -0.04634   0.95472  0.02174 -2.132  0.03301
## race  0.33866   1.40306  0.30960  1.094  0.27402
## wexp -0.02555   0.97477  0.21142 -0.121  0.90380
## mar  -0.29375   0.74546  0.38303 -0.767  0.44314
## paro -0.06421   0.93781  0.19468 -0.330  0.74156
## prio  0.08514   1.08887  0.02896  2.940  0.00328
## work -1.32832   0.26492  0.25072 -5.298 1.17e-07
## 
## Likelihood ratio test=68.65  on 8 df, p=9.114e-12
## n= 19809, number of events= 114</code></pre>
<p>続いて、式<a href="Chapter4.html#eq:eq-cox4">(4.4)</a>のモデルを推定する。<code>work</code>の代わりに<code>worklag</code>を説明変数に入れる。</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="Chapter4.html#cb57-1" aria-hidden="true" tabindex="-1"></a>mod_cox_tlag <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(start, stop, arrest) <span class="sc">~</span> fin <span class="sc">+</span> age <span class="sc">+</span> race <span class="sc">+</span> wexp <span class="sc">+</span> mar </span>
<span id="cb57-2"><a href="Chapter4.html#cb57-2" aria-hidden="true" tabindex="-1"></a>                 <span class="sc">+</span> paro <span class="sc">+</span> prio <span class="sc">+</span> worklag, <span class="at">data =</span> recid_long)</span></code></pre></div>
<p>結果は以下の通り。</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="Chapter4.html#cb58-1" aria-hidden="true" tabindex="-1"></a>mod_cox_tlag</span></code></pre></div>
<pre><code>## Call:
## coxph(formula = Surv(start, stop, arrest) ~ fin + age + race + 
##     wexp + mar + paro + prio + worklag, data = recid_long)
## 
##             coef exp(coef) se(coef)      z        p
## fin     -0.35130   0.70377  0.19181 -1.831 0.067035
## age     -0.04977   0.95144  0.02189 -2.274 0.022969
## race     0.32147   1.37915  0.30912  1.040 0.298369
## wexp    -0.04764   0.95348  0.21323 -0.223 0.823207
## mar     -0.34476   0.70839  0.38322 -0.900 0.368310
## paro    -0.04710   0.95399  0.19630 -0.240 0.810375
## prio     0.09199   1.09635  0.02880  3.194 0.001402
## worklag -0.78689   0.45526  0.21808 -3.608 0.000308
## 
## Likelihood ratio test=47.16  on 8 df, p=1.43e-07
## n= 19377, number of events= 113 
##    (432 observations deleted due to missingness)</code></pre>
<p>推定した3つのモデルの推定値をまとめたものが表<a href="Chapter4.html#tab:tab-coxmodelcomp">4.1</a>である。推定結果自体は非常によく似ているが、先ほどの検定結果を見ると経済的支援の効果は時間依存変数を含まない基本モデルのみで有意になっている。また、時間依存変数の就業状態(<code>work</code>または<code>worklag</code>)が他の変数よりも大きな影響を与えていたことも分かった。、2つ目のモデルのハザード比(<code>Exp(Coef) = 0.265</code>)をみると就業している元服役囚の再犯率が就業していない服役囚の26.5%であると推定された。</p>
<p>ただし、この結果のみでは就業状態が再犯に影響したのか、再犯が就業状態に影響したのかはわからない。そこで、就業状態に1週間のラグがあるモデル3の結果を見ると、2つ目のモデルより効果量は減少するものの、依然として大きな影響を及ぼしていることが分かる。モデル3のハザード比(<code>Exp(Coef) = 0.455</code>)から、就業状態にある元服役囚はそうでない元服役囚に比べて翌週の再犯率が約54.5%低いことが分かる。このように、タイムラグを持つ変数を用いることで再犯が就業状態に影響する可能性を除外することができる。</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="Chapter4.html#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">Covariate =</span> <span class="fu">rownames</span>(mod_cox_ti<span class="sc">$</span>coefficients <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>()),</span>
<span id="cb60-2"><a href="Chapter4.html#cb60-2" aria-hidden="true" tabindex="-1"></a>       <span class="st">&quot;Coef(basic)&quot;</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">sprintf</span>(<span class="st">&quot;%.3f&quot;</span>,<span class="fu">coef</span>(mod_cox))[<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>],<span class="cn">NA</span>),</span>
<span id="cb60-3"><a href="Chapter4.html#cb60-3" aria-hidden="true" tabindex="-1"></a>       <span class="st">&quot;Exp(Coef_basic)&quot;</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">sprintf</span>(<span class="st">&quot;%.3f&quot;</span>,<span class="fu">exp</span>(<span class="fu">coef</span>(mod_cox)))[<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>],<span class="cn">NA</span>),</span>
<span id="cb60-4"><a href="Chapter4.html#cb60-4" aria-hidden="true" tabindex="-1"></a>       <span class="st">&quot;Coef(ti)&quot;</span> <span class="ot">=</span> <span class="fu">sprintf</span>(<span class="st">&quot;%.3f&quot;</span>,<span class="fu">coef</span>(mod_cox_ti))[<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>],</span>
<span id="cb60-5"><a href="Chapter4.html#cb60-5" aria-hidden="true" tabindex="-1"></a>       <span class="st">&quot;Exp(Coef_ti)&quot;</span> <span class="ot">=</span> <span class="fu">sprintf</span>(<span class="st">&quot;%.3f&quot;</span>,<span class="fu">exp</span>(<span class="fu">coef</span>(mod_cox_ti)))[<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>],</span>
<span id="cb60-6"><a href="Chapter4.html#cb60-6" aria-hidden="true" tabindex="-1"></a>       <span class="st">&quot;Coef(tlag)&quot;</span> <span class="ot">=</span> <span class="fu">sprintf</span>(<span class="st">&quot;%.3f&quot;</span>,<span class="fu">coef</span>(mod_cox_tlag))[<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>],</span>
<span id="cb60-7"><a href="Chapter4.html#cb60-7" aria-hidden="true" tabindex="-1"></a>       <span class="st">&quot;Exp(Coef_tlag)&quot;</span> <span class="ot">=</span> <span class="fu">sprintf</span>(<span class="st">&quot;%.3f&quot;</span>,<span class="fu">exp</span>(<span class="fu">coef</span>(mod_cox_tlag))[<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>])) <span class="sc">%&gt;%</span> </span>
<span id="cb60-8"><a href="Chapter4.html#cb60-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Covariate =</span> <span class="fu">ifelse</span>(<span class="fu">str_detect</span>(Covariate,<span class="st">&quot;work&quot;</span>),<span class="st">&quot;work/worklag&quot;</span>,Covariate)) <span class="sc">%&gt;%</span> </span>
<span id="cb60-9"><a href="Chapter4.html#cb60-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">flextable</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb60-10"><a href="Chapter4.html#cb60-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_header_row</span>(<span class="at">colwidth =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>),</span>
<span id="cb60-11"><a href="Chapter4.html#cb60-11" aria-hidden="true" tabindex="-1"></a>                 <span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;&quot;</span>,<span class="st">&quot;基本モデル&quot;</span>,<span class="st">&quot;時間依存独立変数</span><span class="sc">\n</span><span class="st">あり&quot;</span>, <span class="st">&quot;タイムラグのある</span><span class="sc">\n</span><span class="st">時間独立変数あり&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb60-12"><a href="Chapter4.html#cb60-12" aria-hidden="true" tabindex="-1"></a>  flextable<span class="sc">::</span><span class="fu">align</span>(<span class="at">align =</span> <span class="st">&quot;center&quot;</span>, <span class="at">part =</span> <span class="st">&quot;all&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb60-13"><a href="Chapter4.html#cb60-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_caption</span>(<span class="st">&quot;各モデルの推定値の比較&quot;</span>)</span></code></pre></div>
<div class="tabwid"><style>.cl-8b5576bc{}.cl-8b4e85d2{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-8b5193da{margin:0;text-align:center;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-8b51a8de{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-8b51a8df{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-8b51a8e8{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-8b5576bc'>

<caption style="display:table-caption;margin:0pt;text-align:center;border-bottom: 0.00pt solid transparent;border-top: 0.00pt solid transparent;border-left: 0.00pt solid transparent;border-right: 0.00pt solid transparent;padding-top:3pt;padding-bottom:3pt;padding-left:3pt;padding-right:3pt;line-height: 1;background-color:transparent;">
<span id="tab:tab-coxmodelcomp">表4.1: </span><span>各モデルの推定値の比較</span>
</caption>

<thead><tr style="overflow-wrap:break-word;"><th class="cl-8b51a8de"><p class="cl-8b5193da"><span class="cl-8b4e85d2"></span></p></th><th  colspan="2"class="cl-8b51a8de"><p class="cl-8b5193da"><span class="cl-8b4e85d2">基本モデル</span></p></th><th  colspan="2"class="cl-8b51a8de"><p class="cl-8b5193da"><span class="cl-8b4e85d2">時間依存独立変数</span><br><span class="cl-8b4e85d2">あり</span></p></th><th  colspan="2"class="cl-8b51a8de"><p class="cl-8b5193da"><span class="cl-8b4e85d2">タイムラグのある</span><br><span class="cl-8b4e85d2">時間独立変数あり</span></p></th></tr><tr style="overflow-wrap:break-word;"><th class="cl-8b51a8de"><p class="cl-8b5193da"><span class="cl-8b4e85d2">Covariate</span></p></th><th class="cl-8b51a8de"><p class="cl-8b5193da"><span class="cl-8b4e85d2">Coef(basic)</span></p></th><th class="cl-8b51a8de"><p class="cl-8b5193da"><span class="cl-8b4e85d2">Exp(Coef_basic)</span></p></th><th class="cl-8b51a8de"><p class="cl-8b5193da"><span class="cl-8b4e85d2">Coef(ti)</span></p></th><th class="cl-8b51a8de"><p class="cl-8b5193da"><span class="cl-8b4e85d2">Exp(Coef_ti)</span></p></th><th class="cl-8b51a8de"><p class="cl-8b5193da"><span class="cl-8b4e85d2">Coef(tlag)</span></p></th><th class="cl-8b51a8de"><p class="cl-8b5193da"><span class="cl-8b4e85d2">Exp(Coef_tlag)</span></p></th></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">fin</span></p></td><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">-0.379</span></p></td><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">0.684</span></p></td><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">-0.357</span></p></td><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">0.700</span></p></td><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">-0.351</span></p></td><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">0.704</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">age</span></p></td><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">-0.057</span></p></td><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">0.944</span></p></td><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">-0.046</span></p></td><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">0.955</span></p></td><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">-0.050</span></p></td><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">0.951</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">race</span></p></td><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">0.314</span></p></td><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">1.369</span></p></td><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">0.339</span></p></td><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">1.403</span></p></td><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">0.321</span></p></td><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">1.379</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">wexp</span></p></td><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">-0.150</span></p></td><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">0.861</span></p></td><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">-0.026</span></p></td><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">0.975</span></p></td><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">-0.048</span></p></td><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">0.953</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">mar</span></p></td><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">-0.434</span></p></td><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">0.648</span></p></td><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">-0.294</span></p></td><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">0.745</span></p></td><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">-0.345</span></p></td><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">0.708</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">paro</span></p></td><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">-0.085</span></p></td><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">0.919</span></p></td><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">-0.064</span></p></td><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">0.938</span></p></td><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">-0.047</span></p></td><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">0.954</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">prio</span></p></td><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">0.091</span></p></td><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">1.096</span></p></td><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">0.085</span></p></td><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">1.089</span></p></td><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">0.092</span></p></td><td class="cl-8b51a8df"><p class="cl-8b5193da"><span class="cl-8b4e85d2">1.096</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-8b51a8e8"><p class="cl-8b5193da"><span class="cl-8b4e85d2">work/worklag</span></p></td><td class="cl-8b51a8e8"><p class="cl-8b5193da"><span class="cl-8b4e85d2"></span></p></td><td class="cl-8b51a8e8"><p class="cl-8b5193da"><span class="cl-8b4e85d2"></span></p></td><td class="cl-8b51a8e8"><p class="cl-8b5193da"><span class="cl-8b4e85d2">-1.328</span></p></td><td class="cl-8b51a8e8"><p class="cl-8b5193da"><span class="cl-8b4e85d2">0.265</span></p></td><td class="cl-8b51a8e8"><p class="cl-8b5193da"><span class="cl-8b4e85d2">-0.787</span></p></td><td class="cl-8b51a8e8"><p class="cl-8b5193da"><span class="cl-8b4e85d2">0.455</span></p></td></tr></tbody></table></div>
<p><br/></p>
</div>
<div id="時間依存独立変数を含むモデル" class="section level2 hasAnchor" number="4.5">
<h2><span class="header-section-number">4.5</span> 時間依存独立変数を含むモデル<a href="Chapter4.html#時間依存独立変数を含むモデル" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>時間依存独立変数があるモデルの推定をするとき、ある時点で事象が発生した場合、<strong>その時点で事象を経験しうるすべての個体について時間依存変数の値が分かっていなければいけない</strong>。例えば、<span class="math inline">\(t =10\)</span>で事象が発生し、その時点で15人が事象を経験する可能性がある(= リスク集合にいる)場合、15人全員について<span class="math inline">\(t=10\)</span>時点の時間依存変数が分かっていなければいけない。そのため、事象の発生が日単位で測定されているにもかかわらず、時間依存変数の値が1週間ごとにしか測定されていないといったことがあるとき、問題が生じることになる。</p>
<p>このような場合、特定の方法で事象が発生した時点の独立変数の値を<strong>補完して代入</strong>する必要がある。いろいろな方法があるが、最も安全なものは直前に観察された値を使用する方法である。保管によって必要な代入ができたら、次に分析のためにデータを加工する必要がある。加工方法には以下の2つがあるが、統計ソフトではいずれかを使用している(Rはエピソード分割法)。</p>
<div id="プログラミングステートメント法programming-statements-method" class="section level3 hasAnchor" number="4.5.1">
<h3><span class="header-section-number">4.5.1</span> プログラミング・ステートメント法(programming statements method)<a href="Chapter4.html#プログラミングステートメント法programming-statements-method" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>この方法を使用するには、データをワイド形式にする必要がある。すなわち、今回の例では各週の就業状態が1列ずつになるようにする必要がある。</p>
</div>
<div id="エピソード分割法episode-splitting-method" class="section level3 hasAnchor" number="4.5.2">
<h3><span class="header-section-number">4.5.2</span> エピソード分割法(episode splitting method)<a href="Chapter4.html#エピソード分割法episode-splitting-method" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>この方法のデータは先ほど加工した<code>recid_long</code>のようにロング形式で問題ない。それぞれの個体が複数の行を持ち、各行のデータについて観察し始めた時点(<code>start</code>)と観察が終了した時点(<code>stop</code>)を記した列を作る。また独立変数が変化するたびに行を変えるか、もしくは独立変数の変化に関係なく小さな時間間隔ごとに行を変える(どちらでも問題ない)。例えば<code>recid_long</code>では各個体が1週間ごとに1行ずつのデータを持つ。</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="Chapter4.html#cb61-1" aria-hidden="true" tabindex="-1"></a>recid_long <span class="sc">%&gt;%</span> </span>
<span id="cb61-2"><a href="Chapter4.html#cb61-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">50</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb61-3"><a href="Chapter4.html#cb61-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">datatable</span>(<span class="at">options =</span> <span class="fu">list</span>(<span class="at">scrollX =</span> <span class="dv">20</span>))</span></code></pre></div>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-57e23d45764d455cb295" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-57e23d45764d455cb295">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50"],["1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","10","10","10","10","10","10","10","10","10","10","10","10","10","10","10","10","10","10","10","10","10","10","10","10","10","10","10","10","10","10"],[20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],["work1","work2","work3","work4","work5","work6","work7","work8","work9","work10","work11","work12","work13","work14","work15","work16","work17","work18","work19","work20","work1","work2","work3","work4","work5","work6","work7","work8","work9","work10","work11","work12","work13","work14","work15","work16","work17","work18","work19","work20","work21","work22","work23","work24","work25","work26","work27","work28","work29","work30"],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29],[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30],[null,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,null,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>id<\/th>\n      <th>week<\/th>\n      <th>arrest<\/th>\n      <th>fin<\/th>\n      <th>age<\/th>\n      <th>race<\/th>\n      <th>wexp<\/th>\n      <th>mar<\/th>\n      <th>paro<\/th>\n      <th>prio<\/th>\n      <th>educ<\/th>\n      <th>work_week<\/th>\n      <th>work<\/th>\n      <th>start<\/th>\n      <th>stop<\/th>\n      <th>worklag<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"scrollX":20,"columnDefs":[{"className":"dt-right","targets":[2,3,4,5,6,7,8,9,10,11,13,14,15,16]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>

</div>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references csl-bib-body hanging-indent" line-spacing="2">
<div id="ref-Cox1972" class="csl-entry">
Cox, D. R. (1972). Regression models and life-tables. <em>J. R. Stat. Soc.</em>, <em>34</em>(2), 187–202.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="Chapter3.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="sessioninfo.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
