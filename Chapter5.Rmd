# 複数事象のモデル {c5}  
これまでの章では、分析対象の事象を全て同じように扱ってきた。例えば、第\@ref(c2)章では昇進の種類を区別していないし、第\@ref(c3)~\@ref(c4)章は再犯の際の犯罪の種類を区別していない。本章では、複数の事象がある場合に分析を行う方法を解説する。基本的には、一種類の事象の場合に解説した方法を応用できる。  

## 複数事象の分類  
まず話を簡単にするために、二種類の事象がある場合のみに限定して事象が発生する状況を分類する。なお、繰り返しのある事象については次章(\@ref(c6))で解説する。  

### 条件付き過程  
まず一つ目は**条件付き過程**であり、次のように定義される。  

1. 事象の発生または非発生は<u>一連の因果プロセス</u>によって決定される。ある条件が与えられた後、因果メカニズムによってどの種類の事象が発生するかが決定される。  

例としては、携帯電話を購入することを決定した後、iPhoneとAndroidのどちらを購入するかを決定する場合などが挙げられる。こうしたタイプに対して適切な分析は、⓵まずイベント・ヒストリー分析を行って事象の区別をせずに事象の発生だけに着目した分析を行い、⓶どの種類の事象が発生するかを別のモデル(通常は二項ロジットモデルや多項ロジットモデル)で分析する。  

### 並行的過程  
次に考えられるのは**並行的過程**と呼ばれるタイプのものであり、次の条件を満たす。  

2. それぞれの種類の事象の発生は異なる因果メカニズムによって決定される。  

異なる因果メカニズムとは、それぞれの種類の事象の発生が異なる独立変数によって影響されたり、同じ独立変数が事象の種類によって異なる偏回帰係数や線形関数を持っていたりすることを指す。この仮定は、以下の4つの下位タイプに分類できる。  

- 2a. ある種類の事象を経験した個体はほかの種類の事象を経験する可能性がなくなる(= **競合リスク**)。  
例としては、競合する原因による死亡などが挙げられる。心臓病とがんの両方が原因で死亡する可能性はないので、心臓病が原因で死亡した個体はもはやがんで死亡する可能性がない。  

- 2b ある種類の事象を経験すると、その個体はほかの種類の事象の観察対象から外れる。  
例えば国内移動と国外移動を考えるとき、もし個体が国外移動するとその個体を追跡することが困難になることが珍しくない。  

- 2c ある一つの種類の事象を経験しても、他の種類の事象を経験する可能性や個体の観察の継続性に影響を与えない。  
二つの種類の事象が全く無関係であることはないが、分析する際にあたかも無関係のように扱うことが可能な場合はある。例えば、選挙で投票に行くことと結婚することはほとんど関係がないと仮定できるので、そのように扱える。  

- 2d ある一つの事象が生じると、ほかの種類の事象を経験する可能性が増大/減少する  
例えば、妊娠すると結婚する可能性が高まる、といった場合がこれに該当する  

## 並行的過程の分析  
- **2c**  
それぞれの種類の事象が独立すると仮定できるので、前章までの分析をそれぞれに適用すればよい。   

- **2d**  
二つ目の事象について検討する際に必ず一つ目についても考慮する必要がある。この方法はすでに前章までに解説しており、要するに一つ目の事象を時間依存的な独立変数として扱ってしまえばよい。例えば元服役囚の再犯の例では、各週ごとに就業しているかを独立変数に加えていた。  

- **2b**  
ある種類の事象の発生によって、他の種類の発生についての右側打ち切りが生じている例である。このタイプは、前章までの方法で分析することができる。すなわち、ある事象を経験することで個体が観察から脱落してしまったら、その時点で打ち切りが生じたかのように扱えばよい。  

- **2a**  
このタイプに対する分析は2bと似ているが、さらに詳しい解説が必要である。次章以降では、こうしたタイプの事象を扱う「**競合リスク・モデル**」について解説する。  

## 競合リスク・モデル  
競合リスク・モデルでは、まず**タイプ固有(type-specific)ハザード関数**と呼ばれるものを定義する。$m$種類の異なる事象があり、$j = 1,2,...,m$とする。$P_j(t,t+s)$を陸巣集合に入っている個体が種類$j$の事象を時点$t$から$t+s$の期間で経験する条件付き確率とする。ただし、個体が時点$t$より前に$m$個の事象のいずれかを経験していたらリスク集合には入っていないものとする。  

タイプ固有ハザード関数は以下のように定義される。各種類の事象に独自のハザード関数が定義される。  
$$
h_j(t) \lim_{s \rightarrow 0} \frac{P_j(t,t+s)}{s}  
$$

分析では、タイプ固有のハザード関数一つひとつについてモデルを作ることができる。前章までに説明したイベント・ヒストリーのモデルはどれも競合リスクの分析に用いることができる。次章の種類によって全く異なるモデルを当てはめることも可能である。いずれのモデルでも事象の種類ごとに別々に尤度関数を作り、最尤推定法または部分尤度推定法でパラメータを推定する。  

## Rでの分析例  
分析の例として、元服役囚の再犯についての研究を再度取り上げる。再犯で逮捕された犯罪を財産犯(強盗・窃盗など)とそれ以外に分ける。経済的支援は財産犯による再犯のリスクは減らす可能性があるが、それ以外の犯罪には大きく影響するとは考えられない。  

ここでは、以下の式のコックス比例ハザードモデルで推定を行う(式\@ref(eq:eq-risk))。いずれの種類の事象にも同じ独立変数を考えるが、偏回帰係数は異なるとしている。  

$$
log(h_j(t)) = a_j(t) + b_{j1}x_1 + b_{j2}x_2 + \cdots  (\#eq:eq-risk)
$$

変数は以下の通り。今回は時間依存変数は含めない。`type`     

**従属変数に関わるもの**  
- `arrest`: 再犯の有無  
- `type`: 再犯の種類(0: 再犯なし、1: 非財産犯、2: 財産犯)  
- `arrstday`: 再逮捕されたときに出所後何日だったか  

**独立変数**  
- `fin`: 経済的支援の有無  
- `white`: 人種(白人か否か)  
- `ed`: 教育レベル（学校教育を受けた年数)    
- `married`: 出所時の配偶状態(0/1)  
- `age`: 出所時の年齢  
- `male`: 性別(0/1)    
- `numarst`: 前科の数  
- `numprop`: 過去の財産犯の有罪判決の数  
- `crimprop`: 最後の服役が財産犯によるものか(0/1)
- `paro`: 出所が仮釈放か否か(0/1)    

データは以下のとおりである。  
```{r}
tarp <- read_dta("data/tarp.dta")

datatable(tarp,
          options = list(ScrollX = 60))
```

まず、再犯による逮捕の種類を区別しないモデルを以下のように推定する。  
```{r}
mod_rsk_all <- coxph(Surv(arrestday,arrest) ~ fin + age + white + male + married + paro + numprop + 
                       crimprop)
```

